<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="default" />
    <title>Jap Counter - Complete App</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <style>
      :root {
        --theme-color: #ff4500; /* Default orange */
        --theme-text-color: var(--theme-color);
      }
      .btn {
        background: var(--theme-color);
        box-shadow: 0 0 12px var(--theme-color);
      }

      .stat-value,
      .rounds-value,
      .mantra-box,
      .count {
        color: var(--theme-text-color);
      }

      /* --- Polished Style: Slightly Smaller, Smooth Curved Buttons --- */

      /* Minus Buttons (smaller + curved look) */
      .side-btn {
        width: 58px !important;
        height: 58px !important;
        font-size: 23px !important;
        margin: 0 8px !important;
        border-radius: 20px; /* more curve instead of full circle */
        border: 2px solid #ff4500;
        background: linear-gradient(135deg, #ff4500, #ff6b2b);
        color: white;
        font-weight: 600;
        cursor: pointer;
        box-shadow: 0 0 10px rgba(255, 69, 0, 0.5),
          0 4px 10px rgba(0, 0, 0, 0.25);
        transition: all 0.25s ease;
      }

      .side-btn:hover {
        background: linear-gradient(135deg, #ff6b2b, #ff4500);
        transform: scale(1.05);
        box-shadow: 0 0 14px rgba(255, 69, 0, 0.7);
      }

      .side-btn:active {
        transform: scale(0.93);
        background: #e63e00;
        box-shadow: 0 0 8px rgba(230, 62, 0, 0.5);
      }

      /* Unified Manta-style font for all mantras and counts */
      .mantra-box,
      #currentMantraBottom,
      .count {
        font-family: "Noto Sans Devanagari", "Kalam", "Mandali", serif !important;
        color: #000;
        text-shadow: 0 1px 3px rgba(0, 0, 0, 0.25);
        font-weight: bold;
      }

      /* Bottom Buttons (Wallpaper / Set Count / Reset) — smaller + curved */
      .button-row .btn {
        flex: 1;
        margin: 0 5px !important;
        background: linear-gradient(135deg, #ff4500, #ff6b2b);
        border: none;
        padding: 9px 10px !important;
        border-radius: 10px !important; /* smoother curve */
        font-size: 14px !important;
        cursor: pointer;
        text-align: center;
        color: white;
        font-weight: 600;
        box-shadow: 0 0 12px rgba(255, 69, 0, 0.5),
          0 4px 10px rgba(0, 0, 0, 0.2);
        transition: all 0.25s ease;
      }

      .button-row .btn:hover {
        background: linear-gradient(135deg, #ff6b2b, #ff4500);
        transform: translateY(-2px);
        box-shadow: 0 0 16px rgba(255, 69, 0, 0.6);
      }

      .button-row .btn:active {
        transform: scale(0.96);
        background: #e63e00;
        box-shadow: 0 0 8px rgba(230, 62, 0, 0.5);
      }

      /* --- Updated: Larger Minus Buttons & Unified Mantra Font --- */

      /* Make both minus buttons slightly bigger and add spacing */
      .side-btn {
        width: 65px !important;
        height: 65px !important;
        font-size: 26px !important;
        margin: 0 10px !important;
        border-radius: 50%;
        border: 3px solid #ff4500;
        background: #ff4500;
        color: white;
        font-weight: bold;
        cursor: pointer;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.25);
        transition: background 0.3s, transform 0.2s;
      }
      .side-btn:hover {
        background: #ff5722;
        transform: scale(1.05);
      }
      .side-btn:active {
        background: #e63e00;
        transform: scale(0.95);
      }

      /* Apply Manta-style font to all mantras and counts */
      .mantra-box,
      #currentMantraBottom,
      .count {
        font-family: "Noto Sans Devanagari", "Kalam", "Mandali", serif !important;
        color: #000;
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        font-weight: bold;
      }

      /* Base styles with mobile-first approach */
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        -webkit-touch-callout: none;
        -webkit-user-select: none;
        -khtml-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;
      }

      /* Opening Animation Styles - Clean Logo Formation */
      .opening-animation {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: radial-gradient(
          ellipse at center,
          rgba(255, 255, 255, 1),
          rgba(255, 247, 240, 1)
        );
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        z-index: 10000;
        opacity: 1;
        transition: opacity 0.8s ease-out;
        overflow: hidden;
      }

      .opening-animation.hide {
        opacity: 0;
        pointer-events: none;
      }

      .mala-container {
        position: relative;
        width: 200px;
        height: 200px;
        margin-bottom: 40px;
      }

      .mala-bead {
        position: absolute;
        width: 20px;
        height: 20px;
        background: var(--theme-color, #ff4500);
        border-radius: 50%;
        box-shadow: 0 4px 12px var(--theme-color, rgba(255, 69, 0, 0.4)),
          inset 0 2px 4px rgba(255, 255, 255, 0.5);
        opacity: 0;
        transform: scale(0);
        transition: all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
      }

      .mala-bead.show {
        opacity: 1;
        transform: scale(1);
      }

      /* Position beads in perfect circle */
      .mala-bead[data-bead="1"] {
        top: 0;
        left: 50%;
        transform: translateX(-50%) scale(0);
      }
      .mala-bead[data-bead="2"] {
        top: 7%;
        left: 69%;
        transform: translate(-50%, -50%) scale(0);
      }
      .mala-bead[data-bead="3"] {
        top: 20%;
        left: 82%;
        transform: translate(-50%, -50%) scale(0);
      }
      .mala-bead[data-bead="4"] {
        top: 38%;
        left: 90%;
        transform: translate(-50%, -50%) scale(0);
      }
      .mala-bead[data-bead="5"] {
        top: 57%;
        left: 90%;
        transform: translate(-50%, -50%) scale(0);
      }
      .mala-bead[data-bead="6"] {
        top: 75%;
        left: 82%;
        transform: translate(-50%, -50%) scale(0);
      }
      .mala-bead[data-bead="7"] {
        top: 88%;
        left: 69%;
        transform: translate(-50%, -50%) scale(0);
      }
      .mala-bead[data-bead="8"] {
        top: 95%;
        left: 50%;
        transform: translate(-50%, -50%) scale(0);
      }
      .mala-bead[data-bead="9"] {
        top: 88%;
        left: 31%;
        transform: translate(-50%, -50%) scale(0);
      }
      .mala-bead[data-bead="10"] {
        top: 75%;
        left: 18%;
        transform: translate(-50%, -50%) scale(0);
      }
      .mala-bead[data-bead="11"] {
        top: 57%;
        left: 10%;
        transform: translate(-50%, -50%) scale(0);
      }
      .mala-bead[data-bead="12"] {
        top: 38%;
        left: 10%;
        transform: translate(-50%, -50%) scale(0);
      }
      .mala-bead[data-bead="13"] {
        top: 20%;
        left: 18%;
        transform: translate(-50%, -50%) scale(0);
      }
      .mala-bead[data-bead="14"] {
        top: 7%;
        left: 31%;
        transform: translate(-50%, -50%) scale(0);
      }

      /* Inner circle beads */
      .mala-bead[data-bead="15"] {
        top: 15%;
        left: 50%;
        transform: translate(-50%, -50%) scale(0);
      }
      .mala-bead[data-bead="16"] {
        top: 27%;
        left: 65%;
        transform: translate(-50%, -50%) scale(0);
      }
      .mala-bead[data-bead="17"] {
        top: 47%;
        left: 73%;
        transform: translate(-50%, -50%) scale(0);
      }
      .mala-bead[data-bead="18"] {
        top: 68%;
        left: 65%;
        transform: translate(-50%, -50%) scale(0);
      }
      .mala-bead[data-bead="19"] {
        top: 80%;
        left: 50%;
        transform: translate(-50%, -50%) scale(0);
      }
      .mala-bead[data-bead="20"] {
        top: 68%;
        left: 35%;
        transform: translate(-50%, -50%) scale(0);
      }
      .mala-bead[data-bead="21"] {
        top: 47%;
        left: 27%;
        transform: translate(-50%, -50%) scale(0);
      }
      .mala-bead[data-bead="22"] {
        top: 27%;
        left: 35%;
        transform: translate(-50%, -50%) scale(0);
      }

      /* Center beads */
      .mala-bead[data-bead="23"] {
        top: 47%;
        left: 50%;
        transform: translate(-50%, -50%) scale(0);
      }
      .mala-bead[data-bead="24"] {
        top: 47%;
        left: 50%;
        transform: translate(-50%, -50%) scale(0);
      }

      .mala-bead.show[data-bead="1"] {
        transform: translateX(-50%) scale(1);
      }
      .mala-bead.show[data-bead="2"] {
        transform: translate(-50%, -50%) scale(1);
      }
      .mala-bead.show[data-bead="3"] {
        transform: translate(-50%, -50%) scale(1);
      }
      .mala-bead.show[data-bead="4"] {
        transform: translate(-50%, -50%) scale(1);
      }
      .mala-bead.show[data-bead="5"] {
        transform: translate(-50%, -50%) scale(1);
      }
      .mala-bead.show[data-bead="6"] {
        transform: translate(-50%, -50%) scale(1);
      }
      .mala-bead.show[data-bead="7"] {
        transform: translate(-50%, -50%) scale(1);
      }
      .mala-bead.show[data-bead="8"] {
        transform: translate(-50%, -50%) scale(1);
      }
      .mala-bead.show[data-bead="9"] {
        transform: translate(-50%, -50%) scale(1);
      }
      .mala-bead.show[data-bead="10"] {
        transform: translate(-50%, -50%) scale(1);
      }
      .mala-bead.show[data-bead="11"] {
        transform: translate(-50%, -50%) scale(1);
      }
      .mala-bead.show[data-bead="12"] {
        transform: translate(-50%, -50%) scale(1);
      }
      .mala-bead.show[data-bead="13"] {
        transform: translate(-50%, -50%) scale(1);
      }
      .mala-bead.show[data-bead="14"] {
        transform: translate(-50%, -50%) scale(1);
      }
      .mala-bead.show[data-bead="15"] {
        transform: translate(-50%, -50%) scale(1);
      }
      .mala-bead.show[data-bead="16"] {
        transform: translate(-50%, -50%) scale(1);
      }
      .mala-bead.show[data-bead="17"] {
        transform: translate(-50%, -50%) scale(1);
      }
      .mala-bead.show[data-bead="18"] {
        transform: translate(-50%, -50%) scale(1);
      }
      .mala-bead.show[data-bead="19"] {
        transform: translate(-50%, -50%) scale(1);
      }
      .mala-bead.show[data-bead="20"] {
        transform: translate(-50%, -50%) scale(1);
      }
      .mala-bead.show[data-bead="21"] {
        transform: translate(-50%, -50%) scale(1);
      }
      .mala-bead.show[data-bead="22"] {
        transform: translate(-50%, -50%) scale(1);
      }
      .mala-bead.show[data-bead="23"] {
        transform: translate(-50%, -50%) scale(1);
      }
      .mala-bead.show[data-bead="24"] {
        transform: translate(-50%, -50%) scale(1);
      }

      /* Mala Tassel */
      .mala-tassel {
        position: absolute;
        bottom: -60px;
        left: 50%;
        transform: translateX(-50%);
        opacity: 0;
        transition: opacity 0.5s ease-out;
      }

      .tassel-top {
        width: 24px;
        height: 24px;
        background: var(--theme-color, #ff4500);
        border-radius: 50%;
        margin: 0 auto;
        box-shadow: 0 4px 12px var(--theme-color, rgba(255, 69, 0, 0.4)),
          inset 0 2px 4px rgba(255, 255, 255, 0.5);
      }

      .tassel-middle {
        width: 14px;
        height: 8px;
        background: var(--theme-color, #ff4500);
        margin: 2px auto 0;
        border-radius: 0 0 4px 4px;
      }

      .tassel-strings {
        display: flex;
        justify-content: center;
        gap: 3px;
        margin-top: 2px;
      }

      .tassel-string {
        width: 2px;
        height: 30px;
        background: linear-gradient(
          to bottom,
          var(--theme-color, #ff4500),
          transparent
        );
        border-radius: 0 0 2px 2px;
      }

      @keyframes appearTassel {
        from {
          opacity: 0;
          transform: translateY(-20px) scale(0.8);
        }
        to {
          opacity: 1;
          transform: translateY(0) scale(1);
        }
      }

      /* Opening Title and Subtitle */
      .opening-title {
        font-size: 36px;
        font-weight: 700;
        color: #333;
        margin-bottom: 8px;
        opacity: 0;
        animation: slideUp 0.8s ease-out 0.5s both;
        text-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        letter-spacing: 1px;
      }

      .opening-subtitle {
        font-size: 16px;
        color: #666;
        font-weight: 400;
        opacity: 0;
        animation: slideUp 0.8s ease-out 0.8s both;
      }

      @keyframes slideUp {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .loading-dots {
        display: flex;
        gap: 8px;
        margin-top: 20px;
        animation: slideUp 1s ease-out 1.1s both;
      }

      .loading-dot {
        width: 10px;
        height: 10px;
        background: var(--theme-color, #ff4500);
        border-radius: 50%;
        animation: bounce 1.4s ease-in-out infinite both;
      }

      .loading-dot:nth-child(1) {
        animation-delay: -0.32s;
      }
      .loading-dot:nth-child(2) {
        animation-delay: -0.16s;
      }
      .loading-dot:nth-child(3) {
        animation-delay: 0s;
      }

      @keyframes bounce {
        0%,
        80%,
        100% {
          transform: scale(0.8) translateY(0);
          opacity: 0.5;
        }
        40% {
          transform: scale(1.3) translateY(-10px);
          opacity: 1;
        }
      }

      /* Allow text selection for inputs and editable elements */
      input,
      textarea,
      .counter-name-input,
      .modal-content input {
        -webkit-user-select: text;
        -moz-user-select: text;
        -ms-user-select: text;
        user-select: text;
      }

      body {
        font-family: "Poppins", Arial, sans-serif;
        background: linear-gradient(135deg, #fff7f0, #fefaf5);
        background-size: cover;
        background-position: center;
        background-repeat: no-repeat;
        background-attachment: fixed;
        height: 100vh;
        overflow: hidden; /* Prevent any scrolling */
        position: relative;
        transition: background-image 0.5s ease-in-out, filter 0.3s ease;
      }

      /* Remove blur effect - no longer needed */
      body.color-picker-active {
        /* Removed blur effect */
      }

      /* View management */
      .view {
        display: none;
        height: 100vh;
        overflow: hidden;
      }

      .view.active {
        display: flex;
        flex-direction: column;
      }

      /* Optimized Header - reduced size and better positioning */
      .header {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        background: rgba(255, 253, 249, 0.95);
        backdrop-filter: blur(10px);
        padding: 10px 20px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        z-index: 1000;
        height: 60px; /* Fixed smaller height */
      }

      .logo-corner {
        width: 50px; /* Increased from 40px */
        height: 50px; /* Increased from 40px */
        background: #ff4500;
        border-radius: 50%;
        display: flex;
        justify-content: center;
        align-items: center;
        box-shadow: 0 4px 12px rgba(255, 69, 0, 0.3);
        animation: spinAndPulse 4s linear infinite;
        cursor: pointer;
        transition: transform 0.2s ease;
      }

      .logo-corner:hover {
        transform: scale(1.05);
      }

      .logo-corner svg {
        width: 28px; /* Increased from 24px */
        height: 28px; /* Increased from 24px */
        fill: white;
      }

      @keyframes spinAndPulse {
        0% {
          transform: rotate(0deg) scale(1);
        }
        50% {
          transform: rotate(180deg) scale(1.05);
        }
        100% {
          transform: rotate(360deg) scale(1);
        }
      }

      /* HOME VIEW STYLES - Optimized for single page */
      .main-container {
        padding-top: 60px; /* Reduced from 80px */
        height: 100vh;
        display: flex;
        flex-direction: column;
        align-items: center;
        padding-left: 20px;
        padding-right: 20px;
        padding-bottom: 20px; /* Added bottom padding */
        overflow: hidden;
      }

      .welcome-screen {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        flex: 1;
        text-align: center;
        animation: fadeIn 1s ease-in-out;
        width: 100%;
      }

      .welcome-box {
        background: #fffdf9;
        padding: 30px 25px; /* Reduced padding */
        border-radius: 20px;
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12);
        width: 100%;
        max-width: 380px;
        position: relative;
        overflow: hidden;
      }

      .welcome-box::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 4px;
        background: linear-gradient(90deg, #ff4500, #ff6b2b);
      }

      .welcome-logo {
        width: 50px;
        height: 50px;
        background: #ff4500;
        border-radius: 50%;
        display: flex;
        justify-content: center;
        align-items: center;
        margin: 0 auto 15px;
        box-shadow: 0 4px 12px rgba(255, 69, 0, 0.3);
      }

      .welcome-logo svg {
        width: 30px;
        height: 30px;
        fill: white;
      }

      .welcome-title {
        font-size: 22px;
        color: #333;
        margin-bottom: 8px;
        font-weight: 600;
      }

      .welcome-subtitle {
        font-size: 15px;
        color: #666;
        margin-bottom: 25px;
      }

      .counter-name-input {
        width: 100%;
        padding: 12px 18px;
        font-size: 15px;
        border: 2px solid #e0e0e0;
        border-radius: 12px;
        background: #fafafa;
        margin-bottom: 18px;
        transition: all 0.3s ease;
        text-align: center;
        font-family: "Poppins", "Mandali", sans-serif;
      }

      .counter-name-input:focus {
        outline: none;
        border-color: #ff4500;
        background: white;
        box-shadow: 0 0 0 4px rgba(255, 69, 0, 0.1);
      }

      .create-btn {
        width: 100%;
        padding: 12px;
        background: linear-gradient(135deg, #ff4500, #ff6b2b);
        color: white;
        border: none;
        border-radius: 12px;
        font-size: 15px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: 0 4px 12px rgba(255, 69, 0, 0.3);
      }

      .create-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 16px rgba(255, 69, 0, 0.4);
      }

      .home-screen {
        width: 100%;
        max-width: 500px;
        animation: slideIn 0.6s ease-out;
        flex: 1;
        display: flex;
        flex-direction: column;
        overflow: hidden;
      }

      @keyframes slideIn {
        from {
          opacity: 0;
          transform: translateY(30px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .add-counter-btn {
        width: 100%;
        background: #ff4500;
        color: white;
        border: none;
        padding: 12px 20px;
        border-radius: 12px;
        font-size: 15px;
        font-weight: 600;
        margin-bottom: 15px;
        cursor: pointer;
        transition: all 0.3s ease;
        text-transform: uppercase;
        letter-spacing: 1px;
        box-shadow: 0 4px 12px rgba(255, 69, 0, 0.3);
        flex-shrink: 0;
        margin-top: 20px;
      }

      .add-counter-btn:hover {
        background: #ff5722;
        transform: translateY(-2px);
        box-shadow: 0 6px 16px rgba(255, 69, 0, 0.4);
      }

      .counters-grid {
        display: flex;
        flex-direction: column;
        gap: 12px;
        width: 100%;
        flex: 1;
        overflow-y: auto;
        overflow-x: hidden;
        padding-right: 5px;
        scrollbar-width: thin;
        scrollbar-color: #ff4500 transparent;
      }

      /* Custom scrollbar for counters grid */
      .counters-grid::-webkit-scrollbar {
        width: 4px;
      }

      .counters-grid::-webkit-scrollbar-track {
        background: transparent;
      }

      .counters-grid::-webkit-scrollbar-thumb {
        background: #ff4500;
        border-radius: 2px;
      }

      .counter-card {
        background: #fffdf9;
        border-radius: 16px;
        padding: 16px;
        box-shadow: 0 4px 16px rgba(0, 0, 0, 0.08);
        cursor: pointer;
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
        animation: cardSlideIn 0.6s ease-out;
        flex-shrink: 0;
      }

      .counter-card::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 3px;
        background: linear-gradient(90deg, #ff4500, #ff6b2b);
      }

      .counter-card:hover {
        transform: translateY(-4px);
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12);
      }

      .counter-card:active {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(255, 69, 0, 0.15);
      }

      @keyframes cardSlideIn {
        from {
          opacity: 0;
          transform: translateX(-20px);
        }
        to {
          opacity: 1;
          transform: translateX(0);
        }
      }

      .card-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 12px;
      }

      .counter-name-display {
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .counter-icon {
        width: 12px;
        height: 12px;
        background: #ffb74d;
        border-radius: 50%;
      }

      .counter-name {
        font-size: 16px;
        font-weight: 600;
        color: #333;
        font-family: "Poppins", "Mandali", sans-serif;
      }

      .counter-date {
        font-size: 13px;
        color: #666;
      }

      .card-stats {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 16px;
      }

      .stat-section {
        display: flex;
        flex-direction: column;
      }

      .stat-label {
        font-size: 13px;
        color: #666;
        margin-bottom: 4px;
      }

      .stat-value {
        font-size: 28px;
        font-weight: 700;
        color: #ff4500;
        margin-bottom: 2px;
      }

      .stat-secondary {
        font-size: 13px;
        color: #999;
      }

      .stat-rounds {
        text-align: right;
        align-items: flex-end;
      }

      .rounds-label {
        font-size: 13px;
        color: #666;
        margin-bottom: 4px;
      }

      .rounds-value {
        font-size: 22px;
        font-weight: 600;
        color: #ff4500;
      }

      /* COUNTER VIEW STYLES - Optimized for single page */
      .counter-container {
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        text-align: center;
        background: #fffdf9;
        padding: 8px 20px 15px;
        border-radius: 20px;
        box-shadow: 0px 6px 18px rgba(0, 0, 0, 0.15);
        width: 340px;
        height: calc(100vh - 40px); /* Optimized height */
        position: relative;
        animation: fadeInUp 1s ease-in-out;
        margin: 20px auto 20px;
        overflow: hidden; /* Prevent any overflow */
      }

      @keyframes fadeInUp {
        from {
          opacity: 0;
          transform: translateY(30px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .top-bar {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin: 8px 0;
        flex-shrink: 0;
      }

      .logo-circle,
      .menu-bar {
        width: 50px; /* Increased from 40px */
        height: 50px; /* Increased from 40px */
        background: #ff4500;
        border-radius: 50%;
        display: flex;
        justify-content: center;
        align-items: center;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        cursor: pointer;
        transition: transform 0.2s ease;
      }

      .logo-circle:hover {
        transform: scale(1.05);
      }

      .logo-circle svg,
      .menu-bar svg {
        width: 26px; /* Increased from 22px */
        height: 26px; /* Increased from 22px */
        fill: white;
      }

      .logo-circle {
        animation: spinAndPulse 4s linear infinite;
      }

      .menu-dropdown {
        position: absolute;
        top: 60px; /* Adjusted for larger menu button */
        right: 10px;
        background: #fffdf9;
        border-radius: 10px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        display: none;
        flex-direction: column;
        overflow: hidden;
        z-index: 100;
      }

      .menu-dropdown button {
        border: none;
        background: none;
        padding: 12px 24px; /* Increased padding */
        text-align: left;
        cursor: pointer;
        font-size: 15px; /* Increased from 14px */
        color: #000;
      }

      .menu-dropdown button:hover {
        background: #ff4500;
        color: #fff;
      }

      h2 {
        font-size: 20px;
        margin: 4px 0 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 6px;
        flex-shrink: 0;
      }

      h2::before {
        content: "📿";
        font-size: 22px;
      }

      .extra-box {
        margin-bottom: 6px;
        background: #f9f3ea;
        padding: 8px;
        border-radius: 12px;
        text-align: center;
        box-shadow: inset 0px 1px 4px rgba(0, 0, 0, 0.05);
        animation: fadeIn 1.2s ease;
        flex-shrink: 0;
      }

      .extra-box h3 {
        text-align: center;
        margin-bottom: 6px;
        font-size: 15px;
        color: #d97706;
      }

      .extra-box p {
        margin: 1px 0;
        font-size: 13px;
        text-align: center;
      }

      .count {
        font-size: 24px;
        margin: 4px 0 8px;
        font-weight: bold;
        color: #000000; /* Changed to black */
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3); /* Added light black shadow */
        flex-shrink: 0;
      }

      .tap-wrapper {
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 18px; /* Increased from 12px for more distance between minus buttons */
        margin: 6px 0 10px;
        flex-shrink: 0;
      }

      .tap-btn {
        width: 135px; /* Increased from 120px */
        height: 135px; /* Increased from 120px */
        border-radius: 50%;
        background: #ff4500;
        color: white;
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 18px;
        font-weight: bold;
        cursor: pointer;
        border: 4px solid #ff4500;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        text-align: center;
      }

      .tap-btn:hover {
        background: #ff5722;
      }

      .tap-btn:active {
        background: #e63e00;
      }

      .side-btn {
        width: 55px; /* Increased from 50px */
        height: 55px; /* Increased from 50px */
        border-radius: 50%;
        border: 3px solid #ff4500;
        background: #ff4500;
        color: white;
        font-size: 22px; /* Increased from 20px */
        font-weight: bold;
        cursor: pointer;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
      }

      .side-btn:hover {
        background: #ff5722;
      }

      .side-btn:active {
        background: #e63e00;
      }

      .mantra-box {
        position: relative;
        text-align: center;
        margin: 4px 0 8px;
        font-size: 16px;
        font-weight: bold;
        color: #000000; /* Changed to black */
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3); /* Added light black shadow */
        font-family: "Poppins", sans-serif;
        flex-shrink: 0;
      }

      #currentMantraBottom {
        display: inline-block;
        color: #000000; /* Changed to black */
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3); /* Added light black shadow */
        font-weight: bold;
        font-size: 14px;
        font-family: "Noto Sans Devanagari", "Kalam", "Mandali", serif;
      }

      .button-row {
        display: flex;
        justify-content: space-between;
        margin: 8px 0 10px;
        flex-shrink: 0;
      }

      .btn {
        flex: 1;
        margin: 0 4px;
        background: #ff4500;
        border: none;
        padding: 8px 8px; /* Increased from 5px 6px */
        border-radius: 8px;
        font-size: 14px; /* Increased from 12px */
        cursor: pointer;
        text-align: center;
        transition: all 0.2s;
        color: white;
        box-shadow: 0 0 12px #ff4500, 0 4px 8px rgba(0, 0, 0, 0.2);
      }

      .btn::before {
        content: "✨";
        margin-right: 3px;
      }

      .btn:hover {
        background: #ff5722;
        transform: translateY(-2px);
        box-shadow: 0 0 18px #ff5722, 0 6px 12px rgba(0, 0, 0, 0.25);
      }

      .btn:active {
        background: #e63e00;
        box-shadow: 0 0 10px #e63e00, 0 3px 6px rgba(0, 0, 0, 0.2);
      }

      /* Overlay */
      .overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        backdrop-filter: blur(6px);
        background: rgba(0, 0, 0, 0.4);
        display: none;
        opacity: 0;
        transition: opacity 0.3s ease;
        z-index: 950;
      }

      .overlay.show {
        display: block;
        opacity: 1;
      }

      /* Modals - Optimized positioning */
      .settings-modal,
      .history-modal {
        position: fixed;
        left: 0;
        right: 0;
        top: auto;
        bottom: -100%;
        height: 75vh; /* Increased height for better history display */
        max-height: 85vh;
        background: #fffdf9;
        color: #000;
        border-top-left-radius: 18px;
        border-top-right-radius: 18px;
        border: 1px solid #ff4500; /* Thin orange border */
        z-index: 1000;
        transition: bottom 0.3s ease-in-out;
        overflow: hidden; /* Changed to hidden to allow internal scrolling */
        -webkit-overflow-scrolling: touch;
      }

      .settings-modal.show,
      .history-modal.show {
        bottom: 0;
      }

      .settings-header,
      .history-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 12px 20px;
        background: #ff4500;
        position: sticky;
        top: 0;
        z-index: 1100;
        flex-shrink: 0;
      }

      .settings-header h2,
      .history-header h2 {
        color: white;
        font-size: 18px;
      }

      .settings-header h2::before {
        content: "⚙️ ";
      }

      .history-header h2::before {
        content: "📜 ";
      }

      .close-btn {
        background: transparent;
        border: none;
        color: white;
        font-size: 24px; /* Increased from 20px */
        cursor: pointer;
        transition: transform 0.2s;
        padding: 4px; /* Added padding for better touch target */
      }

      .close-btn:hover {
        transform: rotate(90deg);
      }

      .settings-section {
        padding: 12px 20px;
        border-bottom: 1px solid #333;
      }

      .settings-section h3 {
        font-size: 12px;
        color: orange;
        margin-bottom: 8px;
        text-transform: uppercase;
      }

      .setting-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin: 10px 0;
        font-size: 14px;
      }

      .toggle {
        width: 45px;
        height: 22px;
        background: #555;
        border-radius: 11px;
        position: relative;
        cursor: pointer;
        transition: background 0.3s;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 9px;
        color: white;
        font-weight: bold;
      }

      .toggle::before {
        content: "";
        width: 18px;
        height: 18px;
        background: white;
        border-radius: 50%;
        position: absolute;
        left: 2px;
        top: 2px;
        transition: 0.3s;
      }

      .toggle.active {
        background: #ff4500;
      }

      .toggle.active::before {
        left: 25px;
      }

      /* Enhanced Color Picker Styles with better positioning */
      .theme-color-circle {
        width: 24px;
        height: 24px;
        border-radius: 50%;
        background: #ff4500;
        border: 2px solid #fff;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        cursor: pointer;
        transition: transform 0.2s ease;
        position: relative;
      }

      .theme-color-circle:hover {
        transform: scale(1.1);
      }

      .color-picker-dropdown {
        position: fixed;
        right: 20px;
        bottom: 150px;
        background: #fffdf9;
        border-radius: 10px;
        box-shadow: 0 6px 24px rgba(0, 0, 0, 0.25);
        padding: 12px;
        display: none;
        z-index: 10000;
        min-width: 180px;
        max-width: 220px;
        max-height: 280px;
        overflow-y: auto;
        border: 2px solid #ff4500;
        opacity: 0;
        transform: translateY(15px) scale(0.95);
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      }

      .color-picker-dropdown.show {
        display: block;
        opacity: 1;
        transform: translateY(0) scale(1);
      }

      .color-picker-grid {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 8px;
        margin-bottom: 12px;
      }

      .color-option {
        width: 32px;
        height: 32px;
        border-radius: 50%;
        border: 2px solid #fff;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.15);
        cursor: pointer;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        position: relative;
        transform: scale(1);
      }

      .color-option:hover {
        transform: scale(1.1);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.25);
      }

      .color-option:active {
        transform: scale(0.95);
        transition: all 0.1s ease;
      }

      .color-option.selected {
        transform: scale(1.05);
        border-color: #333;
        box-shadow: 0 3px 8px rgba(0, 0, 0, 0.3);
      }

      .color-option.selected::after {
        content: "✓";
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        color: white;
        font-size: 14px;
        font-weight: bold;
        text-shadow: 0 1px 3px rgba(0, 0, 0, 0.7);
        animation: checkmarkPop 0.3s ease;
      }

      @keyframes checkmarkPop {
        0% {
          transform: translate(-50%, -50%) scale(0);
        }
        50% {
          transform: translate(-50%, -50%) scale(1.2);
        }
        100% {
          transform: translate(-50%, -50%) scale(1);
        }
      }

      .color-picker-label {
        font-size: 12px;
        color: #666;
        text-align: center;
        margin-bottom: 10px;
        font-weight: 600;
      }

      .history-content {
        display: flex;
        flex-direction: column;
        height: calc(100% - 60px); /* Subtract header height */
        overflow: hidden;
      }

      .history-tabs {
        display: flex;
        background: #f9f3ea;
        border-bottom: 2px solid #e0e0e0;
        flex-shrink: 0;
        padding: 8px;
        gap: 4px;
      }

      .history-tab {
        flex: 1;
        padding: 12px 14px; /* Increased padding */
        text-align: center;
        cursor: pointer;
        border: none;
        background: transparent;
        font-size: 14px; /* Increased from 13px */
        font-weight: 600;
        color: #666;
        transition: all 0.3s ease;
        border-radius: 8px;
        position: relative;
      }

      .history-tab.active {
        background: #ff4500;
        color: white;
        box-shadow: 0 2px 4px rgba(255, 69, 0, 0.3);
      }

      .history-tab:hover:not(.active) {
        background: #fff2e6;
        color: #ff4500;
      }

      .history-section {
        flex: 1;
        overflow-y: auto;
        padding: 0;
      }

      .history-summary {
        padding: 15px 20px;
        background: #f9f3ea;
        border-bottom: 1px solid #e0e0e0;
      }

      .history-summary h3 {
        font-size: 16px;
        color: #ff4500;
        margin-bottom: 10px;
      }

      .summary-stats {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 15px;
      }

      .summary-stat {
        text-align: center;
      }

      .summary-stat .label {
        font-size: 12px;
        color: #666;
        margin-bottom: 4px;
      }

      .summary-stat .value {
        font-size: 20px;
        font-weight: 700;
        color: #ff4500;
      }

      .history-list {
        padding: 0;
      }

      .history-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 12px 20px;
        border-bottom: 1px solid #f0f0f0;
        transition: background 0.2s ease;
      }

      .history-item:hover {
        background: #fff7f0;
      }

      .history-date {
        display: flex;
        flex-direction: column;
      }

      .date-main {
        font-size: 14px;
        font-weight: 600;
        color: #333;
      }

      .date-sub {
        font-size: 12px;
        color: #666;
      }

      .history-stats {
        display: flex;
        align-items: center;
        gap: 15px;
      }

      .history-count {
        text-align: center;
      }

      .count-value {
        font-size: 16px;
        font-weight: 700;
        color: #ff4500;
      }

      .count-label {
        font-size: 11px;
        color: #666;
        text-transform: uppercase;
      }

      .history-actions {
        display: flex;
        gap: 8px;
      }

      .action-btn {
        padding: 6px 10px; /* Increased padding */
        border: none;
        border-radius: 6px;
        font-size: 13px; /* Increased from 12px */
        cursor: pointer;
        transition: all 0.2s ease;
      }

      .edit-btn {
        background: #4caf50;
        color: white;
      }

      .edit-btn:hover {
        background: #45a049;
        transform: translateY(-1px);
      }

      .delete-btn {
        background: #f44336;
        color: white;
      }

      .delete-btn:hover {
        background: #da190b;
        transform: translateY(-1px);
      }

      /* Statistics Cards */
      .stats-grid {
        display: grid;
        grid-template-columns: repeat(
          4,
          1fr
        ); /* Changed to 4 columns in one row */
        gap: 8px; /* Reduced gap */
        padding: 15px 20px;
        background: #ffffff;
      }

      .stat-card {
        background: linear-gradient(135deg, #ff4500, #ff6b2b);
        color: white;
        padding: 8px 6px; /* Reduced padding to make smaller */
        border-radius: 8px;
        text-align: center;
        box-shadow: 0 2px 8px rgba(255, 69, 0, 0.2);
      }

      .stat-card-value {
        font-size: 16px; /* Reduced font size */
        font-weight: 700;
        margin-bottom: 2px;
      }

      .stat-card-label {
        font-size: 9px; /* Reduced font size */
        opacity: 0.9;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }

      /* Enhanced Filter Chips */
      .filter-chips {
        display: flex;
        gap: 8px;
        overflow-x: auto;
        padding: 15px 20px;
        scrollbar-width: none;
        background: #ffffff;
        border-bottom: 1px solid #e0e0e0;
      }

      .filter-chips::-webkit-scrollbar {
        display: none;
      }

      .filter-chip {
        flex-shrink: 0;
        padding: 8px 16px;
        background: #f8f8f8;
        border: 2px solid #e0e0e0;
        border-radius: 20px;
        font-size: 12px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
      }

      .filter-chip::before {
        content: "";
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(
          90deg,
          transparent,
          rgba(255, 69, 0, 0.1),
          transparent
        );
        transition: left 0.5s ease;
      }

      .filter-chip:hover::before {
        left: 100%;
      }

      .filter-chip.active {
        background: linear-gradient(135deg, #ff4500, #ff6b2b);
        color: white;
        border-color: #ff4500;
        transform: scale(1.05);
        box-shadow: 0 4px 12px rgba(255, 69, 0, 0.3);
      }

      .filter-chip:hover:not(.active) {
        background: #fff2e6;
        border-color: #ff4500;
        color: #ff4500;
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      }

      /* Enhanced History Items */
      .history-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 12px 20px;
        border-bottom: 1px solid #f0f0f0;
        transition: all 0.2s ease;
        position: relative;
      }

      .history-item::before {
        content: "";
        position: absolute;
        left: 0;
        top: 0;
        bottom: 0;
        width: 3px;
        background: #ff4500;
        opacity: 0;
        transition: opacity 0.2s ease;
      }

      .history-item:hover {
        background: #fff7f0;
      }

      .history-item:hover::before {
        opacity: 1;
      }

      .history-item.high-count {
        background: linear-gradient(90deg, rgba(255, 69, 0, 0.05), transparent);
      }

      .history-item.high-count::before {
        opacity: 0.7;
      }

      /* Edit Modal */
      .modal {
        display: none;
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        justify-content: center;
        align-items: center;
      }

      .modal-content {
        background: white;
        padding: 18px;
        border-radius: 12px;
        width: 280px;
        text-align: center;
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2);
        animation: modalFadeIn 0.3s ease;
      }

      @keyframes modalFadeIn {
        from {
          opacity: 0;
          transform: scale(0.9);
        }
        to {
          opacity: 1;
          transform: scale(1);
        }
      }

      .modal-content h3 {
        margin-bottom: 10px;
        font-family: "Poppins", sans-serif;
        font-size: 16px;
      }

      .modal-content input {
        width: 90%;
        padding: 8px;
        margin-bottom: 10px;
        border: 1px solid #ccc;
        border-radius: 6px;
        text-align: center;
        font-size: 14px;
        font-family: "Poppins", sans-serif;
      }

      .modal-actions button {
        padding: 8px 14px; /* Increased padding */
        margin: 0 4px;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-family: "Poppins", sans-serif;
        font-size: 14px; /* Increased font size */
      }

      #saveMantra,
      #saveHistoryEdit {
        background: #4caf50;
        color: white;
      }

      #cancelEdit,
      #cancelHistoryEdit {
        background: #f44336;
        color: white;
      }

      /* No data message */
      .no-data {
        text-align: center;
        padding: 40px 20px;
        color: #666;
      }

      .no-data-icon {
        font-size: 48px;
        margin-bottom: 15px;
      }

      .no-data-text {
        font-size: 16px;
        margin-bottom: 5px;
      }

      .no-data-subtext {
        font-size: 14px;
        color: #999;
      }

      /* Animations */
      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      /* Responsive optimizations for all mobile devices */
      @media (max-height: 700px) {
        #counterView {
          justify-content: flex-start;
          align-items: center;
          padding-top: 0;
        }

        .counter-container {
          height: calc(100vh - 120px);
          margin: 0 auto;
          padding: 4px 20px 15px;
          position: sticky;
          top: 0;
        }

        .top-bar {
          margin: 4px 0;
        }

        h2 {
          margin: 1px 0 3px;
          font-size: 17px;
        }

        .extra-box {
          padding: 4px;
          margin-bottom: 3px;
        }

        .count {
          font-size: 19px;
          margin: 1px 0 3px;
        }

        .tap-wrapper {
          margin: 3px 0 4px;
        }

        .tap-btn {
          width: 110px; /* Adjusted for smaller screens but still bigger */
          height: 110px; /* Adjusted for smaller screens but still bigger */
          font-size: 15px;
        }

        .side-btn {
          width: 45px; /* Adjusted for smaller screens but still bigger */
          height: 45px; /* Adjusted for smaller screens but still bigger */
          font-size: 18px; /* Adjusted for smaller screens but still bigger */
        }

        .mantra-box {
          margin: 1px 0 3px;
          font-size: 15px;
        }

        .button-row {
          margin: 4px 0 8px;
        }

        .btn {
          padding: 6px 7px; /* Adjusted for smaller screens but still bigger */
          font-size: 13px; /* Adjusted for smaller screens but still bigger */
        }
      }

      @media (max-height: 600px) {
        #counterView {
          justify-content: flex-start;
          align-items: center;
          padding-top: 0;
        }

        .counter-container {
          height: calc(100vh - 140px);
          margin: 0 auto;
          padding: 2px 20px 10px;
          position: sticky;
          top: 0;
        }

        .top-bar {
          margin: 2px 0;
        }

        h2 {
          margin: 1px 0 1px;
          font-size: 15px;
        }

        .extra-box {
          padding: 3px;
          margin-bottom: 1px;
        }

        .extra-box p {
          font-size: 11px;
        }

        .count {
          font-size: 16px;
          margin: 1px 0 2px;
        }

        .tap-wrapper {
          margin: 2px 0 3px;
        }

        .tap-btn {
          width: 95px; /* Adjusted for very small screens but still bigger */
          height: 95px; /* Adjusted for very small screens but still bigger */
          font-size: 14px;
        }

        .side-btn {
          width: 40px; /* Adjusted for very small screens but still bigger */
          height: 40px; /* Adjusted for very small screens but still bigger */
          font-size: 16px; /* Adjusted for very small screens but still bigger */
        }

        .mantra-box {
          font-size: 13px;
          margin: 1px 0 2px;
        }

        .button-row {
          margin: 3px 0 5px;
        }

        .btn {
          padding: 5px 6px; /* Adjusted for very small screens but still bigger */
          font-size: 12px; /* Adjusted for very small screens but still bigger */
        }
      }

      /* Mobile responsive design for all screen widths */
      @media (max-width: 480px) {
        /* Small mobile devices */
        .main-container,
        .counter-container {
          padding-left: 10px;
          padding-right: 10px;
          width: 100%;
          max-width: 100%;
        }

        .header {
          padding: 8px 15px;
          height: 50px;
        }

        .logo-corner {
          width: 45px; /* Adjusted for mobile but still bigger */
          height: 45px; /* Adjusted for mobile but still bigger */
        }

        .logo-corner svg {
          width: 24px; /* Adjusted for mobile but still bigger */
          height: 24px; /* Adjusted for mobile but still bigger */
        }

        .main-container {
          padding-top: 50px;
        }

        .welcome-box {
          margin: 0 5px;
          padding: 20px 15px;
          max-width: 100%;
        }

        .welcome-title {
          font-size: 20px;
        }

        .welcome-subtitle {
          font-size: 14px;
        }

        .counter-name-input {
          font-size: 14px;
          padding: 10px 15px;
        }

        .create-btn {
          font-size: 14px;
          padding: 10px;
        }

        .add-counter-btn {
          font-size: 14px;
          padding: 10px 15px;
        }

        .counter-card {
          padding: 12px;
        }

        .counter-name {
          font-size: 14px;
        }

        .counter-date {
          font-size: 11px;
        }

        .stat-value {
          font-size: 22px;
        }

        .rounds-value {
          font-size: 16px;
        }

        /* Counter view adjustments for small mobile */
        .counter-container {
          width: 100%;
          max-width: 100%;
          margin: 10px auto;
          padding: 6px 15px 10px;
        }

        .top-bar {
          margin: 6px 0;
        }

        .logo-circle,
        .menu-bar {
          width: 45px; /* Adjusted for mobile but still bigger */
          height: 45px; /* Adjusted for mobile but still bigger */
        }

        .logo-circle svg,
        .menu-bar svg {
          width: 22px; /* Adjusted for mobile but still bigger */
          height: 22px; /* Adjusted for mobile but still bigger */
        }

        h2 {
          font-size: 16px;
          margin: 3px 0 6px;
        }

        .extra-box {
          padding: 6px;
          margin-bottom: 4px;
        }

        .extra-box h3 {
          font-size: 13px;
        }

        .extra-box p {
          font-size: 12px;
        }

        .count {
          font-size: 20px;
          margin: 3px 0 6px;
        }

        .tap-wrapper {
          margin: 4px 0 6px;
          gap: 14px; /* Adjusted for mobile but still with good distance */
        }

        .tap-btn {
          width: 115px; /* Adjusted for mobile but still bigger */
          height: 115px; /* Adjusted for mobile but still bigger */
          font-size: 16px;
        }

        .side-btn {
          width: 48px; /* Adjusted for mobile but still bigger */
          height: 48px; /* Adjusted for mobile but still bigger */
          font-size: 20px; /* Adjusted for mobile but still bigger */
        }

        .mantra-box {
          font-size: 14px;
          margin: 3px 0 6px;
        }

        .button-row {
          margin: 6px 0 8px;
          gap: 4px;
        }

        .btn {
          padding: 7px 5px; /* Still bigger than original */
          font-size: 12px; /* Still bigger than original */
          margin: 0 2px;
        }

        /* Modal adjustments for small mobile */
        .settings-modal,
        .history-modal {
          height: 85vh;
          max-height: 90vh;
        }

        .settings-header,
        .history-header {
          padding: 10px 15px;
        }

        .settings-header h2,
        .history-header h2 {
          font-size: 16px;
        }

        .settings-section {
          padding: 10px 15px;
        }

        .setting-item {
          margin: 8px 0;
          font-size: 13px;
        }

        .toggle {
          width: 40px;
          height: 20px;
        }

        .toggle::before {
          width: 16px;
          height: 16px;
        }

        .toggle.active::before {
          left: 22px;
        }

        .theme-color-circle {
          width: 20px;
          height: 20px;
        }

        /* Color picker adjustments for small mobile */
        .color-picker-dropdown {
          right: 10px;
          left: 10px;
          bottom: 100px;
          max-width: none;
          padding: 10px;
        }

        .color-picker-label {
          font-size: 11px;
        }

        .color-option {
          width: 28px;
          height: 28px;
        }

        .color-option.selected::after {
          font-size: 12px;
        }

        /* History modal adjustments */
        .history-tabs {
          padding: 6px;
          gap: 2px;
        }

        .history-tab {
          padding: 10px 12px; /* Still bigger than original */
          font-size: 13px; /* Still bigger than original */
        }

        .stats-grid {
          padding: 10px 15px;
          gap: 6px;
        }

        .stat-card {
          padding: 6px 4px;
        }

        .stat-card-value {
          font-size: 12px;
        }

        .stat-card-label {
          font-size: 7px;
        }

        .history-summary {
          padding: 10px 15px;
        }

        .history-summary h3 {
          font-size: 14px;
        }

        .summary-stats {
          gap: 10px;
        }

        .summary-stat .value {
          font-size: 16px;
        }

        .summary-stat .label {
          font-size: 10px;
        }

        .filter-chips {
          padding: 10px 15px;
          gap: 6px;
        }

        .filter-chip {
          padding: 6px 12px;
          font-size: 11px;
        }

        .history-item {
          padding: 10px 15px;
        }

        .date-main {
          font-size: 13px;
        }

        .date-sub {
          font-size: 11px;
        }

        .count-value {
          font-size: 14px;
        }

        .count-label {
          font-size: 10px;
        }

        .action-btn {
          padding: 5px 8px; /* Still bigger than original */
          font-size: 12px; /* Still bigger than original */
        }

        .close-btn {
          font-size: 22px; /* Adjusted for mobile but still bigger */
          padding: 3px; /* Adjusted for mobile but still has padding */
        }

        .menu-dropdown button {
          padding: 10px 20px; /* Adjusted for mobile but still bigger */
          font-size: 14px; /* Adjusted for mobile but still bigger */
        }
      }

      @media (min-width: 481px) and (max-width: 768px) {
        /* Medium mobile devices and small tablets */
        .main-container,
        .counter-container {
          padding-left: 15px;
          padding-right: 15px;
        }

        .welcome-box {
          margin: 0 10px;
          max-width: 450px;
        }

        .counter-container {
          width: 380px;
          max-width: 95%;
        }

        .tap-btn {
          width: 125px; /* Bigger than original */
          height: 125px; /* Bigger than original */
          font-size: 17px;
        }

        .side-btn {
          width: 52px; /* Bigger than original */
          height: 52px; /* Bigger than original */
          font-size: 21px; /* Bigger than original */
        }

        .btn {
          padding: 7px 9px; /* Still bigger than original */
          font-size: 13px; /* Still bigger than original */
        }

        /* Modal adjustments for medium mobile */
        .settings-modal,
        .history-modal {
          height: 80vh;
          max-height: 85vh;
        }

        .color-picker-dropdown {
          right: 15px;
          bottom: 120px;
          min-width: 200px;
          max-width: 250px;
        }

        .color-option {
          width: 35px;
          height: 35px;
        }

        .stat-card {
          padding: 7px 5px;
        }

        .stat-card-value {
          font-size: 15px;
        }

        .stat-card-label {
          font-size: 8px;
        }
      }

      @media (min-width: 769px) and (max-width: 1024px) {
        /* Large mobile devices and tablets */
        .counter-container {
          width: 400px;
        }

        .tap-btn {
          width: 140px; /* Bigger than original */
          height: 140px; /* Bigger than original */
          font-size: 18px;
        }

        .side-btn {
          width: 58px; /* Bigger than original */
          height: 58px; /* Bigger than original */
          font-size: 24px; /* Bigger than original */
        }

        .color-picker-dropdown {
          right: 20px;
          bottom: 140px;
        }
      }

      /* Landscape orientation adjustments */
      @media (orientation: landscape) and (max-height: 500px) {
        .counter-container {
          height: calc(100vh - 20px);
          padding: 2px 15px 8px;
        }

        .top-bar {
          margin: 2px 0;
        }

        h2 {
          font-size: 14px;
          margin: 1px 0 2px;
        }

        .extra-box {
          padding: 2px;
          margin-bottom: 2px;
        }

        .extra-box h3 {
          font-size: 12px;
        }

        .extra-box p {
          font-size: 10px;
        }

        .count {
          font-size: 16px;
          margin: 1px 0 2px;
        }

        .tap-wrapper {
          margin: 2px 0 3px;
          gap: 10px; /* Smaller gap for landscape but still with distance */
        }

        .tap-btn {
          width: 85px; /* Adjusted for landscape but still bigger */
          height: 85px; /* Adjusted for landscape but still bigger */
          font-size: 13px;
        }

        .side-btn {
          width: 35px; /* Adjusted for landscape but still bigger */
          height: 35px; /* Adjusted for landscape but still bigger */
          font-size: 16px; /* Adjusted for landscape but still bigger */
        }

        .mantra-box {
          font-size: 12px;
          margin: 1px 0 2px;
        }

        .button-row {
          margin: 2px 0 4px;
        }

        .btn {
          padding: 4px 6px; /* Still bigger in landscape */
          font-size: 10px;
        }
      }

      /* Touch-friendly improvements */
      @media (pointer: coarse) {
        .tap-btn,
        .side-btn,
        .btn,
        .create-btn,
        .add-counter-btn,
        .counter-card,
        .color-option,
        .filter-chip,
        .history-tab,
        .action-btn,
        .toggle,
        .theme-color-circle {
          touch-action: manipulation;
          -webkit-tap-highlight-color: transparent;
        }

        .tap-btn:active,
        .side-btn:active {
          transform: scale(0.95);
        }

        .btn:active {
          transform: translateY(0) scale(0.95);
        }

        .counter-card:active {
          transform: translateY(-1px) scale(0.98);
        }
      }

      /* High DPI display adjustments */
      @media (-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi) {
        .logo-corner svg,
        .logo-circle svg,
        .menu-bar svg {
          image-rendering: -webkit-optimize-contrast;
          image-rendering: crisp-edges;
        }
      }

      /* Google Ads space adjustments for mobile */
      @media (max-width: 768px) {
        body {
          padding-bottom: 80px;
        }
      }

      @media (max-width: 480px) {
        body {
          padding-bottom: 60px;
        }
      }

      /* Loading animations */
      .loading {
        opacity: 0;
        transform: translateY(20px);
        transition: all 0.4s ease;
      }

      .loaded {
        opacity: 1;
        transform: translateY(0);
      }

      /* Counter view centering */
      #counterView {
        justify-content: center;
        align-items: center;
      }

      /* Wallpaper Gallery Modal Styles */
      .wallpaper-modal {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.95);
        z-index: 10000;
        display: none;
        overflow-y: auto;
        animation: fadeIn 0.3s ease;
      }

      .wallpaper-modal.show {
        display: block;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
        }
        to {
          opacity: 1;
        }
      }

      .wallpaper-modal-content {
        max-width: 1200px;
        margin: 0 auto;
        padding: 80px 20px 40px;
      }

      .wallpaper-modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 30px;
      }

      .wallpaper-modal-title {
        font-size: 28px;
        font-weight: 700;
        color: white;
        text-align: center;
        flex: 1;
      }

      .wallpaper-close-btn {
        position: fixed;
        top: 20px;
        right: 20px;
        width: 45px;
        height: 45px;
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
        border: 2px solid rgba(255, 255, 255, 0.2);
        border-radius: 50%;
        color: white;
        font-size: 24px;
        cursor: pointer;
        transition: all 0.3s ease;
        z-index: 10001;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .wallpaper-close-btn:hover {
        background: rgba(255, 0, 0, 0.8);
        transform: rotate(90deg) scale(1.1);
      }

      .wallpaper-grid {
        display: grid;
        grid-template-columns: 1fr;
        gap: 25px;
      }

      @media (min-width: 768px) {
        .wallpaper-grid {
          grid-template-columns: repeat(2, 1fr);
        }
      }

      .wallpaper-card {
        position: relative;
        overflow: hidden;
        border-radius: 12px;
        border: 2px solid rgba(255, 69, 0, 0.3);
        background: white;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        transition: all 0.5s ease;
        cursor: pointer;
      }

      .wallpaper-card:hover {
        box-shadow: 0 10px 40px -10px rgba(255, 69, 0, 0.5);
        transform: scale(1.02);
        border-color: rgba(255, 69, 0, 0.6);
      }

      .wallpaper-card-image-wrapper {
        aspect-ratio: 1 / 1;
        overflow: hidden;
      }

      .wallpaper-card-image {
        width: 100%;
        height: 100%;
        object-fit: cover;
        transition: transform 0.7s ease;
      }

      .wallpaper-card:hover .wallpaper-card-image {
        transform: scale(1.1);
      }

      .wallpaper-card-overlay {
        position: absolute;
        inset: 0;
        background: linear-gradient(
          to top,
          rgba(0, 0, 0, 0.7),
          transparent,
          transparent
        );
        opacity: 0;
        transition: opacity 0.5s ease;
      }

      .wallpaper-card:hover .wallpaper-card-overlay {
        opacity: 1;
      }

      .wallpaper-card-title {
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        padding: 20px;
        font-size: 20px;
        font-weight: 700;
        color: white;
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.8);
        transform: translateY(100%);
        transition: transform 0.5s ease;
      }

      .wallpaper-card:hover .wallpaper-card-title {
        transform: translateY(0);
      }

      /* Lightbox Styles */
      .wallpaper-lightbox {
        position: fixed;
        inset: 0;
        background: rgba(0, 0, 0, 0.98);
        z-index: 10002;
        display: none;
        align-items: center;
        justify-content: center;
        padding: 2rem;
        animation: fadeIn 0.3s ease;
      }

      .wallpaper-lightbox.active {
        display: flex;
      }

      .wallpaper-lightbox-content {
        position: relative;
        max-width: 90vw;
        max-height: 90vh;
        animation: scaleIn 0.3s ease;
      }

      @keyframes scaleIn {
        from {
          transform: scale(0.9);
          opacity: 0;
        }
        to {
          transform: scale(1);
          opacity: 1;
        }
      }

      .wallpaper-lightbox-image {
        max-width: 100%;
        max-height: 85vh;
        object-fit: contain;
        border-radius: 8px;
        box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.8);
      }

      .wallpaper-lightbox-title {
        text-align: center;
        color: white;
        font-size: 24px;
        font-weight: 700;
        margin-top: 15px;
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.8);
      }

      .wallpaper-lightbox-controls {
        position: absolute;
        top: -50px;
        right: 0;
        display: flex;
        gap: 10px;
      }

      .wallpaper-lightbox-btn {
        min-width: 45px;
        height: 45px;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 0 15px;
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
        border: 2px solid rgba(255, 255, 255, 0.2);
        border-radius: 8px;
        color: white;
        cursor: pointer;
        transition: all 0.3s ease;
        font-size: 14px;
        font-weight: 600;
        white-space: nowrap;
      }

      .wallpaper-lightbox-btn:hover {
        background: rgba(255, 69, 0, 0.8);
        transform: scale(1.05);
      }

      .wallpaper-lightbox-close {
        position: absolute;
        top: 15px;
        right: 15px;
        width: 45px;
        height: 45px;
        display: flex;
        align-items: center;
        justify-content: center;
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
        border: 2px solid rgba(255, 255, 255, 0.2);
        border-radius: 50%;
        color: white;
        cursor: pointer;
        transition: all 0.3s ease;
        font-size: 24px;
      }

      .wallpaper-lightbox-close:hover {
        background: rgba(255, 0, 0, 0.8);
        transform: rotate(90deg) scale(1.1);
      }
    </style>
  </head>
  <body>
    <!-- Opening Animation -->
    <div class="opening-animation" id="openingAnimation">
      <div class="mala-container" id="malaContainer">
        <div class="mala-bead" data-bead="1"></div>
        <div class="mala-bead" data-bead="2"></div>
        <div class="mala-bead" data-bead="3"></div>
        <div class="mala-bead" data-bead="4"></div>
        <div class="mala-bead" data-bead="5"></div>
        <div class="mala-bead" data-bead="6"></div>
        <div class="mala-bead" data-bead="7"></div>
        <div class="mala-bead" data-bead="8"></div>
        <div class="mala-bead" data-bead="9"></div>
        <div class="mala-bead" data-bead="10"></div>
        <div class="mala-bead" data-bead="11"></div>
        <div class="mala-bead" data-bead="12"></div>
        <div class="mala-bead" data-bead="13"></div>
        <div class="mala-bead" data-bead="14"></div>
        <div class="mala-bead" data-bead="15"></div>
        <div class="mala-bead" data-bead="16"></div>
        <div class="mala-bead" data-bead="17"></div>
        <div class="mala-bead" data-bead="18"></div>
        <div class="mala-bead" data-bead="19"></div>
        <div class="mala-bead" data-bead="20"></div>
        <div class="mala-bead" data-bead="21"></div>
        <div class="mala-bead" data-bead="22"></div>
        <div class="mala-bead" data-bead="23"></div>
        <div class="mala-bead" data-bead="24"></div>

        <div class="mala-tassel" id="malaTassel">
          <div class="tassel-top"></div>
          <div class="tassel-middle"></div>
          <div class="tassel-strings">
            <div class="tassel-string"></div>
            <div class="tassel-string"></div>
            <div class="tassel-string"></div>
            <div class="tassel-string"></div>
            <div class="tassel-string"></div>
          </div>
        </div>
      </div>
      <div class="opening-title">Jap Counter</div>
      <div class="opening-subtitle">Spiritual Counting Companion</div>
      <div class="loading-dots">
        <div class="loading-dot"></div>
        <div class="loading-dot"></div>
        <div class="loading-dot"></div>
      </div>
    </div>

    <!-- Header with rotating logo (shown on counter view) -->
    <div class="header" id="counterHeader" style="display: none">
      <div class="logo-corner" title="Back to Home" onclick="goBackHome()">
        <svg viewBox="0 0 100 100">
          <circle cx="50" cy="20" r="8"></circle>
          <circle cx="70" cy="30" r="8"></circle>
          <circle cx="80" cy="50" r="8"></circle>
          <circle cx="70" cy="70" r="8"></circle>
          <circle cx="50" cy="80" r="8"></circle>
          <circle cx="30" cy="70" r="8"></circle>
          <circle cx="20" cy="50" r="8"></circle>
          <circle cx="30" cy="30" r="8"></circle>
          <rect x="45" y="85" width="10" height="12" rx="2"></rect>
        </svg>
      </div>
    </div>

    <!-- HOME VIEW -->
    <div class="view active" id="homeView">
      <!-- Header with rotating logo -->
      <div class="header">
        <div class="logo-corner">
          <svg viewBox="0 0 100 100">
            <circle cx="50" cy="20" r="8"></circle>
            <circle cx="70" cy="30" r="8"></circle>
            <circle cx="80" cy="50" r="8"></circle>
            <circle cx="70" cy="70" r="8"></circle>
            <circle cx="50" cy="80" r="8"></circle>
            <circle cx="30" cy="70" r="8"></circle>
            <circle cx="20" cy="50" r="8"></circle>
            <circle cx="30" cy="30" r="8"></circle>
            <rect x="45" y="85" width="10" height="12" rx="2"></rect>
          </svg>
        </div>
      </div>

      <div class="main-container">
        <!-- Welcome screen for first counter -->
        <div class="welcome-screen" id="welcomeScreen">
          <div class="welcome-box">
            <div class="welcome-logo">
              <svg viewBox="0 0 100 100">
                <circle cx="50" cy="20" r="8"></circle>
                <circle cx="70" cy="30" r="8"></circle>
                <circle cx="80" cy="50" r="8"></circle>
                <circle cx="70" cy="70" r="8"></circle>
                <circle cx="50" cy="80" r="8"></circle>
                <circle cx="30" cy="70" r="8"></circle>
                <circle cx="20" cy="50" r="8"></circle>
                <circle cx="30" cy="30" r="8"></circle>
                <rect x="45" y="85" width="10" height="12" rx="2"></rect>
              </svg>
            </div>
            <h1 class="welcome-title">Create Your Counter</h1>
            <p class="welcome-subtitle">
              Give a name to your spiritual counter
            </p>
            <input
              type="text"
              class="counter-name-input"
              id="counterNameInput"
              placeholder="Enter counter name (e.g., ॐ नमः शिवाय)"
              maxlength="30"
            />
            <button class="create-btn" id="createCounterBtn">
              Create Counter
            </button>
          </div>
        </div>

        <!-- Home screen with counters -->
        <div class="home-screen" id="homeScreen" style="display: none">
          <button class="add-counter-btn" id="addCounterBtn">
            + Add New Counter
          </button>
          <div class="counters-grid" id="countersGrid">
            <!-- Counter cards will be dynamically added here -->
          </div>
        </div>
      </div>
    </div>

    <!-- COUNTER VIEW -->
    <div class="view" id="counterView">
      <!-- Edit Mantra Modal -->
      <div id="editModal" class="modal">
        <div class="modal-content">
          <h3>Edit Mantra</h3>
          <input type="text" id="mantraInput" />
          <div class="modal-actions">
            <button id="saveMantra">Save</button>
            <button id="cancelEdit">Cancel</button>
          </div>
        </div>
      </div>

      <!-- Edit History Modal -->
      <div id="editHistoryModal" class="modal">
        <div class="modal-content">
          <h3>Edit Day Count</h3>
          <p id="editHistoryDate">Date:</p>
          <input
            type="number"
            id="historyCountInput"
            placeholder="Enter count"
            min="0"
          />
          <div class="modal-actions">
            <button id="saveHistoryEdit">Save</button>
            <button id="cancelHistoryEdit">Cancel</button>
          </div>
        </div>
      </div>

      <div class="overlay" id="overlay"></div>

      <div class="counter-container">
        <div class="top-bar">
          <div class="logo-circle" title="Back to Home" onclick="goBackHome()">
            <svg viewBox="0 0 100 100">
              <circle cx="50" cy="20" r="8"></circle>
              <circle cx="70" cy="30" r="8"></circle>
              <circle cx="80" cy="50" r="8"></circle>
              <circle cx="70" cy="70" r="8"></circle>
              <circle cx="50" cy="80" r="8"></circle>
              <circle cx="30" cy="70" r="8"></circle>
              <circle cx="20" cy="50" r="8"></circle>
              <circle cx="30" cy="30" r="8"></circle>
              <rect x="45" y="85" width="10" height="12" rx="2"></rect>
            </svg>
          </div>
          <div class="menu-bar" onclick="toggleMenu()">
            <svg viewBox="0 0 100 100">
              <rect x="20" y="25" width="60" height="8" rx="4"></rect>
              <rect x="20" y="45" width="60" height="8" rx="4"></rect>
              <rect x="20" y="65" width="60" height="8" rx="4"></rect>
            </svg>
          </div>
          <div class="menu-dropdown" id="menuDropdown">
            <button onclick="goBackHome(); closeMenu()">🏠 Back to Home</button>
            <button onclick="openSettings(); closeMenu()">Settings</button>
            <button onclick="openHistory(); closeMenu()">History</button>
          </div>
        </div>

        <h2 id="counterTitle">Jap Counter</h2>

        <div class="extra-box">
          <h3>Session Info</h3>
          <p><b>Today:</b> <span id="today">0</span></p>
          <p><b>108 ×</b> <span id="todayRounds">0</span></p>
          <p><b>Lifetime:</b> <span id="lifetime">0</span></p>
          <p><b>108 ×</b> <span id="lifetimeRounds">0</span></p>
        </div>

        <p>Today's Count:</p>
        <div class="count" id="count">0 / 108</div>

        <!-- TAP SECTION -->
        <div class="tap-wrapper">
          <button class="side-btn" onclick="decrement()">−</button>
          <button class="tap-btn" onclick="increment()">+1<br />Tap</button>
          <button class="side-btn" onclick="decrement()">−</button>
        </div>

        <!-- Current Mantra -->
        <div class="mantra-box">
          Current Mantra: <span id="currentMantraBottom">ॐ नमः शिवाय</span>
        </div>

        <div class="button-row">
          <button class="btn" onclick="changeWallpaper()">Wallpaper</button>
          <button class="btn" onclick="setJapCount()">Set Jap Count</button>
          <button class="btn" onclick="resetAll()">Reset</button>
        </div>
      </div>

      <!-- Settings Modal -->
      <div class="settings-modal" id="settingsModal">
        <div class="settings-header">
          <h2>Settings</h2>
          <button class="close-btn" onclick="closeSettings()">✕</button>
        </div>
        <div class="settings-section">
          <h3>Common settings</h3>
          <div class="setting-item">
            <span>Theme shade</span>
            <div
              class="theme-color-circle"
              id="themeColorCircle"
              onclick="toggleColorPicker()"
            ></div>
          </div>
          <div class="setting-item">
            <span>Sound alert</span>
            <div class="toggle" onclick="toggleSwitch(this)"></div>
          </div>
        </div>
        <div class="settings-section">
          <h3>Counter specific settings</h3>
          <div class="setting-item">
            <span>Counter name</span>
            <span id="settingsCounterName">Default</span>
          </div>
          <div class="setting-item">
            <span>Theme color</span>
            <span>Default (Orange)</span>
          </div>
          <div class="setting-item">
            <span>Regular haptic feedback</span>
            <div class="toggle active" onclick="toggleSwitch(this)"></div>
          </div>
          <div class="setting-item">
            <span>Long haptic feedback</span>
            <div class="toggle active" onclick="toggleSwitch(this)"></div>
          </div>
          <div class="setting-item">
            <span>Size of 1 cycle/mala</span>
            <span id="settingsTarget">108</span>
          </div>
          <div class="setting-item">
            <span>Vibration</span>
            <div
              id="vibrationToggle"
              class="toggle active"
              onclick="toggleVibration(this)"
            >
              <span class="toggle-text">ON</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Color Picker Dropdown (positioned independently) -->
      <div class="color-picker-dropdown" id="colorPickerDropdown">
        <div class="color-picker-label">Choose Theme Color</div>
        <div class="color-picker-grid">
          <div
            class="color-option selected"
            style="background: #ff4500"
            data-color="#ff4500"
            onclick="selectThemeColor('#ff4500')"
          ></div>
          <div
            class="color-option"
            style="background: #e91e63"
            data-color="#e91e63"
            onclick="selectThemeColor('#e91e63')"
          ></div>
          <div
            class="color-option"
            style="background: #9c27b0"
            data-color="#9c27b0"
            onclick="selectThemeColor('#9c27b0')"
          ></div>
          <div
            class="color-option"
            style="background: #673ab7"
            data-color="#673ab7"
            onclick="selectThemeColor('#673ab7')"
          ></div>
          <div
            class="color-option"
            style="background: #3f51b5"
            data-color="#3f51b5"
            onclick="selectThemeColor('#3f51b5')"
          ></div>
          <div
            class="color-option"
            style="background: #2196f3"
            data-color="#2196f3"
            onclick="selectThemeColor('#2196f3')"
          ></div>
          <div
            class="color-option"
            style="background: #00bcd4"
            data-color="#00bcd4"
            onclick="selectThemeColor('#00bcd4')"
          ></div>
          <div
            class="color-option"
            style="background: #009688"
            data-color="#009688"
            onclick="selectThemeColor('#009688')"
          ></div>
          <div
            class="color-option"
            style="background: #4caf50"
            data-color="#4caf50"
            onclick="selectThemeColor('#4caf50')"
          ></div>
          <div
            class="color-option"
            style="background: #8bc34a"
            data-color="#8bc34a"
            onclick="selectThemeColor('#8bc34a')"
          ></div>
          <div
            class="color-option"
            style="background: #ffc107"
            data-color="#ffc107"
            onclick="selectThemeColor('#ffc107')"
          ></div>
          <div
            class="color-option"
            style="background: #ff9800"
            data-color="#ff9800"
            onclick="selectThemeColor('#ff9800')"
          ></div>
          <div
            class="color-option"
            style="background: #795548"
            data-color="#795548"
            onclick="selectThemeColor('#795548')"
          ></div>
          <div
            class="color-option"
            style="background: #607d8b"
            data-color="#607d8b"
            onclick="selectThemeColor('#607d8b')"
          ></div>
          <div
            class="color-option"
            style="background: #f44336"
            data-color="#f44336"
            onclick="selectThemeColor('#f44336')"
          ></div>
          <div
            class="color-option"
            style="background: #ff5722"
            data-color="#ff5722"
            onclick="selectThemeColor('#ff5722')"
          ></div>
        </div>
      </div>

      <!-- Enhanced History Modal -->
      <div class="history-modal" id="historyModal">
        <div class="history-header">
          <h2>History</h2>
          <button class="close-btn" onclick="closeHistory()">✕</button>
        </div>
        <div class="history-content">
          <div class="history-tabs">
            <button
              class="history-tab active"
              onclick="switchHistoryTab('summary')"
            >
              Summary
            </button>
            <button class="history-tab" onclick="switchHistoryTab('detailed')">
              Daily History
            </button>
          </div>

          <!-- Summary Tab -->
          <div class="history-section" id="historySummaryTab">
            <div class="stats-grid">
              <div class="stat-card">
                <div class="stat-card-value" id="summaryToday">0</div>
                <div class="stat-card-label">Today</div>
              </div>
              <div class="stat-card">
                <div class="stat-card-value" id="summaryTodayRounds">0</div>
                <div class="stat-card-label">Rounds</div>
              </div>
              <div class="stat-card">
                <div class="stat-card-value" id="summaryLifetime">0</div>
                <div class="stat-card-label">Lifetime</div>
              </div>
              <div class="stat-card">
                <div class="stat-card-value" id="summaryBestDay">0</div>
                <div class="stat-card-label">Best Day</div>
              </div>
            </div>

            <div class="history-summary">
              <h3>📊 Analytics Overview</h3>
              <div class="summary-stats">
                <div class="summary-stat">
                  <div class="label">7-Day Average</div>
                  <div class="value" id="summary7Day">0</div>
                </div>
                <div class="summary-stat">
                  <div class="label">Monthly Total</div>
                  <div class="value" id="summaryMonthly">0</div>
                </div>
                <div class="summary-stat">
                  <div class="label">Active Days</div>
                  <div class="value" id="summaryActiveDays">0</div>
                </div>
                <div class="summary-stat">
                  <div class="label">Streak Days</div>
                  <div class="value" id="summaryStreak">0</div>
                </div>
              </div>
            </div>
          </div>

          <!-- Detailed History Tab -->
          <div
            class="history-section"
            id="historyDetailedTab"
            style="display: none"
          >
            <div class="filter-chips">
              <div class="filter-chip active" onclick="filterHistory('all')">
                All Days
              </div>
              <div class="filter-chip" onclick="filterHistory('high')">
                High Count (>50)
              </div>
              <div class="filter-chip" onclick="filterHistory('completed')">
                Completed Rounds
              </div>
              <div class="filter-chip" onclick="filterHistory('recent')">
                Last 7 Days
              </div>
              <div class="filter-chip" onclick="filterHistory('month')">
                This Month
              </div>
            </div>

            <div class="history-list" id="historyList">
              <!-- History items will be dynamically added here -->
            </div>
          </div>
        </div>
      </div>
    </div>

    <script>
      // Global variables
      let counters = [];
      let currentCounter = null;
      let currentView = "home";
      let currentHistoryTab = "summary";
      let currentFilter = "all";
      let currentSort = "date";
      let isDescending = true;
      let currentThemeColor = "#ff4500"; // Default orange theme

      // Counter-specific variables
      let count = 0;
      let dailyCount = 0;
      let lifetimeCount = 0;
      let japTarget = 108;
      let vibrationOn = true;

      // Initialize app with mobile optimizations
      window.addEventListener("load", function () {
        // Start mala formation animation
        startMalaAnimation();

        loadCounters();
        checkDailyReset(); // Check this before loading counter data
        loadThemeColor(); // Load saved theme color
        loadSavedWallpaper(); // Load saved wallpaper
        if (counters.length > 0) {
          showHomeScreen();
        }
        initializeEditButton();
        initializeMobileOptimizations();
      });

      function startMalaAnimation() {
        const beads = document.querySelectorAll(".mala-bead");
        let currentBead = 0;

        function showNextBead() {
          if (currentBead < beads.length) {
            playTukSound();
            beads[currentBead].classList.add("show");
            currentBead++;
            setTimeout(showNextBead, 100);
          } else {
            setTimeout(() => {
              const tassel = document.getElementById("malaTassel");
              if (tassel) {
                tassel.style.opacity = "1";
                tassel.style.animation = "appearTassel 0.5s ease-out forwards";
                playCompletionSound();
                setTimeout(() => {
                  hideOpeningAnimation();
                }, 1500);
              }
            }, 300);
          }
        }

        setTimeout(showNextBead, 500);
      }

      function playTukSound() {
        // Create audio context for more realistic tuk sound
        try {
          const audioContext = new (window.AudioContext ||
            window.webkitAudioContext)();

          // Create multiple oscillators for richer sound
          const oscillator1 = audioContext.createOscillator();
          const oscillator2 = audioContext.createOscillator();
          const gainNode = audioContext.createGain();
          const filter = audioContext.createBiquadFilter();

          // Configure filter for wooden bead sound
          filter.type = "lowpass";
          filter.frequency.setValueAtTime(1200, audioContext.currentTime);
          filter.Q.setValueAtTime(2, audioContext.currentTime);

          // Connect audio nodes
          oscillator1.connect(filter);
          oscillator2.connect(filter);
          filter.connect(gainNode);
          gainNode.connect(audioContext.destination);

          // Set frequencies for wood-like tuk sound
          oscillator1.frequency.setValueAtTime(900, audioContext.currentTime);
          oscillator1.frequency.exponentialRampToValueAtTime(
            300,
            audioContext.currentTime + 0.08
          );

          oscillator2.frequency.setValueAtTime(1400, audioContext.currentTime);
          oscillator2.frequency.exponentialRampToValueAtTime(
            500,
            audioContext.currentTime + 0.06
          );

          // Shape the sound envelope
          gainNode.gain.setValueAtTime(0, audioContext.currentTime);
          gainNode.gain.linearRampToValueAtTime(
            0.15,
            audioContext.currentTime + 0.01
          );
          gainNode.gain.exponentialRampToValueAtTime(
            0.001,
            audioContext.currentTime + 0.1
          );

          // Use square wave for sharper attack
          oscillator1.type = "square";
          oscillator2.type = "triangle";

          oscillator1.start(audioContext.currentTime);
          oscillator1.stop(audioContext.currentTime + 0.1);
          oscillator2.start(audioContext.currentTime);
          oscillator2.stop(audioContext.currentTime + 0.08);
        } catch (e) {
          // Fallback for browsers without audio context
          console.log("🔊 Tuk!");
        }
      }

      function playCompletionSound() {
        // Create audio context for completion chime
        try {
          const audioContext = new (window.AudioContext ||
            window.webkitAudioContext)();
          const oscillator = audioContext.createOscillator();
          const gainNode = audioContext.createGain();

          oscillator.connect(gainNode);
          gainNode.connect(audioContext.destination);

          oscillator.frequency.setValueAtTime(523, audioContext.currentTime); // C5
          oscillator.frequency.setValueAtTime(
            659,
            audioContext.currentTime + 0.2
          ); // E5
          oscillator.frequency.setValueAtTime(
            784,
            audioContext.currentTime + 0.4
          ); // G5

          gainNode.gain.setValueAtTime(0.15, audioContext.currentTime);
          gainNode.gain.exponentialRampToValueAtTime(
            0.01,
            audioContext.currentTime + 0.6
          );

          oscillator.start(audioContext.currentTime);
          oscillator.stop(audioContext.currentTime + 0.6);
        } catch (e) {
          // Fallback for browsers without audio context
          console.log("Completion chime");
        }
      }

      function hideOpeningAnimation() {
        const animation = document.getElementById("openingAnimation");
        if (animation) {
          animation.classList.add("hide");
          setTimeout(() => {
            animation.style.display = "none";
          }, 800);
        }
      }

      // Mobile-specific optimizations
      function initializeMobileOptimizations() {
        // Prevent zoom on double tap for iOS
        let lastTouchEnd = 0;
        document.addEventListener(
          "touchend",
          function (event) {
            const now = new Date().getTime();
            if (now - lastTouchEnd <= 300) {
              event.preventDefault();
            }
            lastTouchEnd = now;
          },
          false
        );

        // Improve touch response for main counter buttons
        const tapBtn = document.querySelector(".tap-btn");
        const sideBtns = document.querySelectorAll(".side-btn");

        if (tapBtn) {
          tapBtn.addEventListener(
            "touchstart",
            function (e) {
              e.preventDefault();
              this.style.transform = "scale(0.95)";
            },
            { passive: false }
          );

          tapBtn.addEventListener(
            "touchend",
            function (e) {
              e.preventDefault();
              this.style.transform = "scale(1)";
              increment();
            },
            { passive: false }
          );
        }

        sideBtns.forEach((btn) => {
          btn.addEventListener(
            "touchstart",
            function (e) {
              e.preventDefault();
              this.style.transform = "scale(0.9)";
            },
            { passive: false }
          );

          btn.addEventListener(
            "touchend",
            function (e) {
              e.preventDefault();
              this.style.transform = "scale(1)";
              decrement();
            },
            { passive: false }
          );
        });

        // Enhance counter card touch response
        const counterCards = document.querySelectorAll(".counter-card");
        counterCards.forEach((card) => {
          card.addEventListener("touchstart", function (e) {
            this.style.transform = "translateY(-2px) scale(0.98)";
          });

          card.addEventListener("touchend", function (e) {
            this.style.transform = "translateY(0) scale(1)";
          });
        });

        // Optimize modal close for mobile
        const overlay = document.getElementById("overlay");
        if (overlay) {
          overlay.addEventListener("touchstart", function (e) {
            if (e.target === this) {
              closeSettings();
              closeHistory();
            }
          });
        }

        // Prevent scroll on modal content
        const modals = document.querySelectorAll(
          ".settings-modal, .history-modal"
        );
        modals.forEach((modal) => {
          modal.addEventListener("touchmove", function (e) {
            e.stopPropagation();
          });
        });
      }

      // Date management functions
      function checkDailyReset() {
        const today = new Date().toDateString();
        const lastActiveDate = localStorage.getItem("lastActiveDate");

        if (lastActiveDate && lastActiveDate !== today) {
          // New day detected - save yesterday's data for all counters
          counters.forEach((counter) => {
            if (counter.todayCount && counter.todayCount > 0) {
              if (!counter.dailyHistory) {
                counter.dailyHistory = {};
              }
              counter.dailyHistory[lastActiveDate] = counter.todayCount;
              counter.todayCount = 0; // Reset daily count for new day
              counter.currentCount = 0; // Reset current session count
            }
          });
          saveCounters();
        }

        localStorage.setItem("lastActiveDate", today);
      }

      function saveDailyHistory(date, count) {
        if (!currentCounter) return;

        if (!currentCounter.dailyHistory) {
          currentCounter.dailyHistory = {};
        }

        if (count > 0) {
          currentCounter.dailyHistory[date] = count;
          saveCounters();
        }
      }

      function saveCurrentDayHistory() {
        if (!currentCounter) return;

        const today = new Date().toDateString();
        if (dailyCount > 0) {
          if (!currentCounter.dailyHistory) {
            currentCounter.dailyHistory = {};
          }
          currentCounter.dailyHistory[today] = dailyCount;
        }
      }

      function getCurrentDayHistory() {
        if (!currentCounter || !currentCounter.dailyHistory) return {};
        return currentCounter.dailyHistory;
      }

      function formatDateForDisplay(dateString) {
        const date = new Date(dateString);
        const today = new Date();
        const yesterday = new Date(today);
        yesterday.setDate(yesterday.getDate() - 1);

        // Normalize dates to remove time component
        const dateOnly = new Date(
          date.getFullYear(),
          date.getMonth(),
          date.getDate()
        );
        const todayOnly = new Date(
          today.getFullYear(),
          today.getMonth(),
          today.getDate()
        );
        const yesterdayOnly = new Date(
          yesterday.getFullYear(),
          yesterday.getMonth(),
          yesterday.getDate()
        );

        if (dateOnly.getTime() === todayOnly.getTime()) {
          return "Today";
        } else if (dateOnly.getTime() === yesterdayOnly.getTime()) {
          return "Yesterday";
        } else {
          // Always show year for clarity
          return date.toLocaleDateString("en-US", {
            weekday: "short",
            month: "short",
            day: "numeric",
            year: "numeric",
          });
        }
      }

      function getDayOfWeek(dateString) {
        const date = new Date(dateString);
        return date.toLocaleDateString("en-US", {
          weekday: "long",
          month: "short",
          day: "numeric",
        });
      }

      // View management
      function showView(viewName) {
        // Hide all views
        document.querySelectorAll(".view").forEach((view) => {
          view.classList.remove("active");
        });

        // Show selected view
        document.getElementById(viewName + "View").classList.add("active");
        currentView = viewName;
      }

      // HOME FUNCTIONS
      function loadCounters() {
        try {
          const saved = localStorage.getItem("japCounters");
          if (saved) {
            counters = JSON.parse(saved);
            // Migrate old data structure if needed
            counters.forEach((counter) => {
              if (!counter.dailyHistory) {
                counter.dailyHistory = {};
              }
            });
          }
        } catch (e) {
          console.warn("Could not load counters from localStorage");
          counters = [];
        }
      }

      function saveCounters() {
        try {
          localStorage.setItem("japCounters", JSON.stringify(counters));
        } catch (e) {
          console.warn("Could not save counters to localStorage");
        }
      }

      function generateId() {
        return Date.now().toString(36) + Math.random().toString(36).substr(2);
      }

      function formatDate(date) {
        const options = { day: "numeric", month: "short", year: "numeric" };
        return date.toLocaleDateString("en-GB", options);
      }

      function createCounter(name) {
        return {
          id: generateId(),
          name: name.trim(),
          createdDate: new Date(),
          lastUpdated: new Date(),
          todayCount: 0,
          lifetimeCount: 0,
          currentCount: 0,
          target: 108,
          mantra: "ॐ नमः शिवाय",
          dailyHistory: {},
        };
      }

      function showHomeScreen() {
        document.getElementById("welcomeScreen").style.display = "none";
        document.getElementById("homeScreen").style.display = "flex";
        renderCounters();
      }

      function showWelcomeScreen() {
        document.getElementById("homeScreen").style.display = "none";
        document.getElementById("welcomeScreen").style.display = "flex";
      }

      function renderCounters() {
        const grid = document.getElementById("countersGrid");
        grid.innerHTML = "";

        counters.forEach((counter, index) => {
          const todayRounds = Math.floor(counter.todayCount / counter.target);
          const lifetimeRounds = Math.floor(
            counter.lifetimeCount / counter.target
          );

          const card = document.createElement("div");
          card.className = "counter-card loading";
          card.innerHTML = `
<div class="card-header">
<div class="counter-name-display">
<div class="counter-icon"></div>
<span class="counter-name">${counter.name}</span>
</div>
<span class="counter-date">${formatDate(new Date(counter.lastUpdated))}</span>
</div>
<div class="card-stats">
<div class="stat-section">
<div class="stat-label">Today</div>
<div class="stat-value">${counter.todayCount}</div>
<div class="stat-secondary">Lifetime</div>
<div class="stat-value" style="font-size: 20px; margin-top: 4px;">${
            counter.lifetimeCount
          }</div>
</div>
<div class="stat-section stat-rounds">
<div class="rounds-label">108 ×</div>
<div class="rounds-value">${todayRounds}</div>
<div class="rounds-label" style="margin-top: 8px;">108 ×</div>
<div class="rounds-value" style="font-size: 18px;">${lifetimeRounds}</div>
</div>
</div>
`;

          // Add click handler to open counter
          card.addEventListener("click", function (e) {
            openCounter(counter.id);
          });

          // Add long press handler to delete counter
          let longPressTimer;
          card.addEventListener("touchstart", function (e) {
            longPressTimer = setTimeout(() => {
              deleteCounter(counter.id);
            }, 800); // 800ms long press
          });

          card.addEventListener("touchend", function (e) {
            clearTimeout(longPressTimer);
          });

          card.addEventListener("touchmove", function (e) {
            clearTimeout(longPressTimer);
          });

          // For desktop - mousedown/mouseup
          card.addEventListener("mousedown", function (e) {
            longPressTimer = setTimeout(() => {
              deleteCounter(counter.id);
            }, 800);
          });

          card.addEventListener("mouseup", function (e) {
            clearTimeout(longPressTimer);
          });

          card.addEventListener("mouseleave", function (e) {
            clearTimeout(longPressTimer);
          });

          grid.appendChild(card);

          setTimeout(() => {
            card.classList.remove("loading");
            card.classList.add("loaded");
          }, index * 100);
        });
      }

      function deleteCounter(counterId) {
        if (confirm("Delete this counter? This action cannot be undone.")) {
          counters = counters.filter((c) => c.id !== counterId);
          saveCounters();
          if (counters.length === 0) {
            showWelcomeScreen();
          } else {
            renderCounters();
          }
        }
      }

      function openCounter(counterId) {
        const counter = counters.find((c) => c.id === counterId);
        if (counter) {
          currentCounter = counter;
          loadCounterData(counter);
          showView("counter");
        }
      }

      // COUNTER FUNCTIONS
      function loadCounterData(counter) {
        count = counter.currentCount || 0;
        dailyCount = counter.todayCount || 0;
        lifetimeCount = counter.lifetimeCount || 0;
        japTarget = counter.target || 108;

        // Set counter name as the current mantra
        const mantraElement = document.getElementById("currentMantraBottom");
        if (mantraElement && counter.name) {
          mantraElement.textContent = counter.name;
        }

        const headerTitle = document.getElementById("counterTitle");
        if (headerTitle) {
          headerTitle.innerHTML = ` Jap Counter`;
        }

        const settingsCounterName = document.getElementById(
          "settingsCounterName"
        );
        if (settingsCounterName) {
          settingsCounterName.textContent = counter.name;
        }

        const settingsTarget = document.getElementById("settingsTarget");
        if (settingsTarget) {
          settingsTarget.textContent = counter.target;
        }

        updateDisplay();
      }

      function saveCounterData() {
        if (currentCounter) {
          // Save today's count to daily history
          const today = new Date().toDateString();
          if (!currentCounter.dailyHistory) {
            currentCounter.dailyHistory = {};
          }

          // Always save today's count, even if zero (for accurate tracking)
          if (dailyCount >= 0) {
            currentCounter.dailyHistory[today] = dailyCount;
          }

          currentCounter.currentCount = count;
          currentCounter.todayCount = dailyCount;
          currentCounter.lifetimeCount = lifetimeCount;
          currentCounter.target = japTarget;
          currentCounter.lastUpdated = new Date();

          const counterIndex = counters.findIndex(
            (c) => c.id === currentCounter.id
          );
          if (counterIndex !== -1) {
            counters[counterIndex] = currentCounter;
            saveCounters();
          }
        }
      }

      function updateDisplay() {
        document.getElementById("count").innerText = count + " / " + japTarget;
        document.getElementById("today").innerText = dailyCount;
        document.getElementById("todayRounds").innerText = Math.floor(
          dailyCount / japTarget
        );
        document.getElementById("lifetime").innerText = lifetimeCount;
        document.getElementById("lifetimeRounds").innerText = Math.floor(
          lifetimeCount / japTarget
        );
      }

      function increment() {
        count++;
        dailyCount++;
        lifetimeCount++;

        updateDisplay();
        saveCounterData();

        if (vibrationOn && navigator.vibrate) {
          navigator.vibrate(100);
        }

        if (count >= japTarget) {
          alert("One Mala Completed 🙏");
          count = 0;
          updateDisplay();
          saveCounterData();
        }
      }

      function decrement() {
        if (count > 0) {
          count--;
          dailyCount = Math.max(0, dailyCount - 1);
          lifetimeCount = Math.max(0, lifetimeCount - 1);

          updateDisplay();
          saveCounterData();

          if (vibrationOn && navigator.vibrate) {
            navigator.vibrate(100);
          }
        }
      }

      function resetAll() {
        if (confirm("Are you sure you want to reset all counts?")) {
          count = 0;
          dailyCount = 0;
          lifetimeCount = 0;
          updateDisplay();
          saveCounterData();
        }
      }

      function setJapCount() {
        let newCount = prompt(
          "Enter Jap target (e.g., 108, 54, 27):",
          japTarget
        );
        if (newCount && !isNaN(newCount) && newCount > 0) {
          japTarget = parseInt(newCount);
          count = 0;
          updateDisplay();
          saveCounterData();

          const settingsTarget = document.getElementById("settingsTarget");
          if (settingsTarget) {
            settingsTarget.textContent = japTarget;
          }

          alert("Jap target set to " + japTarget);
        }
      }

      // Deity images data - Traditional temple-style images
      const deities = [
        {
          name: "Lord Ganesha",
          image: "/images/ganesha.jpg",
        },
        {
          name: "Lord Shiva",
          image: "/images/shiva.jpg",
        },
        {
          name: "Goddess Lakshmi",
          image: "/images/lakshmi.jpg",
        },
        {
          name: "Lord Krishna",
          image: "/images/krishna.jpg",
        },
        {
          name: "Goddess Durga",
          image: "/images/durga.jpg",
        },
        {
          name: "Lord Hanuman",
          image: "/images/hanuman.jpg",
        },
        {
          name: "Goddess Saraswati",
          image: "/images/saraswati.jpg",
        },
        {
          name: "Lord Rama",
          image: "/images/rama.jpg",
        },
        {
          name: "Goddess Kali",
          image: "/images/kali.jpg",
        },
        {
          name: "Lord Vishnu",
          image: "/images/vishnu.jpg",
        },
      ];

      let currentDeityForLightbox = null;

      function changeWallpaper() {
        const modal = document.getElementById("wallpaperModal");
        modal.classList.add("show");
        renderWallpaperGallery();
      }

      function closeWallpaperModal() {
        const modal = document.getElementById("wallpaperModal");
        modal.classList.remove("show");
      }

      function renderWallpaperGallery() {
        const grid = document.getElementById("wallpaperGrid");
        grid.innerHTML = "";

        deities.forEach((deity) => {
          const card = document.createElement("div");
          card.className = "wallpaper-card";
          card.onclick = () => openWallpaperLightbox(deity);
          card.innerHTML = `
            <div class="wallpaper-card-image-wrapper">
              <img 
                src="${deity.image}" 
                alt="${deity.name}"
                class="wallpaper-card-image"
                onerror="this.src='https://via.placeholder.com/800/FF4500/FFFFFF?text=${encodeURIComponent(
                  deity.name
                )}'"
              />
            </div>
            <div class="wallpaper-card-overlay"></div>
            <div class="wallpaper-card-title">${deity.name}</div>
          `;
          grid.appendChild(card);
        });
      }

      function openWallpaperLightbox(deity) {
        currentDeityForLightbox = deity;
        const lightbox = document.getElementById("wallpaperLightbox");
        const lightboxImage = document.getElementById("wallpaperLightboxImage");
        const lightboxTitle = document.getElementById("wallpaperLightboxTitle");

        lightboxImage.src = deity.image;
        lightboxImage.alt = deity.name;
        lightboxTitle.textContent = deity.name;

        lightbox.classList.add("active");
        document.body.style.overflow = "hidden";
      }

      function closeWallpaperLightbox(event) {
        if (
          event &&
          (event.target.id === "wallpaperLightbox" ||
            event.target.closest(".wallpaper-lightbox-close"))
        ) {
          const lightbox = document.getElementById("wallpaperLightbox");
          lightbox.classList.remove("active");
          document.body.style.overflow = "auto";
          currentDeityForLightbox = null;
        }
      }

      function setAsWallpaper(event) {
        event.stopPropagation();
        if (!currentDeityForLightbox) return;

        // Set the wallpaper as body background
        document.body.style.backgroundImage = `url('${currentDeityForLightbox.image}')`;

        // Save the wallpaper preference
        localStorage.setItem(
          "selectedWallpaper",
          currentDeityForLightbox.image
        );

        // Close the lightbox and modal
        closeWallpaperLightbox(event);
        closeWallpaperModal();

        // Show confirmation
        alert(`Wallpaper set to ${currentDeityForLightbox.name} 🙏`);
      }

      function downloadWallpaper(event) {
        event.stopPropagation();
        if (!currentDeityForLightbox) return;

        const link = document.createElement("a");
        link.href = currentDeityForLightbox.image;
        link.download = `${currentDeityForLightbox.name.replace(
          /\s+/g,
          "_"
        )}.jpg`;

        fetch(currentDeityForLightbox.image)
          .then((response) => response.blob())
          .then((blob) => {
            const blobUrl = URL.createObjectURL(blob);
            link.href = blobUrl;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(blobUrl);
          })
          .catch(() => {
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
          });
      }

      function loadSavedWallpaper() {
        const savedWallpaper = localStorage.getItem("selectedWallpaper");
        if (savedWallpaper) {
          document.body.style.backgroundImage = `url('${savedWallpaper}')`;
        }
      }

      function goBackHome() {
        saveCounterData();
        showView("home");
        if (counters.length > 0) {
          showHomeScreen();
        } else {
          showWelcomeScreen();
        }
      }

      function openSettings() {
        document.getElementById("settingsModal").classList.add("show");
        document.getElementById("overlay").classList.add("show");
      }

      function closeSettings() {
        document.getElementById("settingsModal").classList.remove("show");
        document.getElementById("overlay").classList.remove("show");
        // Remove blur effect when closing settings
        document.body.classList.remove("color-picker-active");
      }

      // ENHANCED HISTORY FUNCTIONS
      function openHistory() {
        updateHistorySummary();
        updateHistoryDetailed();
        document.getElementById("historyModal").classList.add("show");
        document.getElementById("overlay").classList.add("show");
      }

      function closeHistory() {
        document.getElementById("historyModal").classList.remove("show");
        document.getElementById("overlay").classList.remove("show");
      }

      function switchHistoryTab(tabName) {
        currentHistoryTab = tabName;

        // Update tab buttons
        document.querySelectorAll(".history-tab").forEach((tab) => {
          tab.classList.remove("active");
        });
        event.target.classList.add("active");

        // Show/hide content
        if (tabName === "summary") {
          document.getElementById("historySummaryTab").style.display = "block";
          document.getElementById("historyDetailedTab").style.display = "none";
        } else {
          document.getElementById("historySummaryTab").style.display = "none";
          document.getElementById("historyDetailedTab").style.display = "block";
        }
      }

      function updateHistorySummary() {
        if (!currentCounter) return;

        const history = currentCounter.dailyHistory || {};
        const historyEntries = Object.entries(history);
        const today = new Date().toDateString();

        // Basic stats
        document.getElementById("summaryToday").innerText = dailyCount;
        document.getElementById("summaryTodayRounds").innerText = Math.floor(
          dailyCount / japTarget
        );
        document.getElementById("summaryLifetime").innerText = lifetimeCount;

        // Active days calculation - count all days with count > 0
        const activeDaysFromHistory = historyEntries.filter(
          ([date, count]) => count > 0
        ).length;
        const isTodayActive = dailyCount > 0 ? 1 : 0;
        const activeDays = activeDaysFromHistory + isTodayActive;

        // Calculate 7-day average - get last 7 days including today
        const now = new Date();
        const last7DaysData = [];

        for (let i = 0; i < 7; i++) {
          const checkDate = new Date(now);
          checkDate.setDate(checkDate.getDate() - i);
          const dateStr = checkDate.toDateString();

          if (dateStr === today) {
            last7DaysData.push(dailyCount);
          } else {
            last7DaysData.push(history[dateStr] || 0);
          }
        }

        const avg7Day =
          last7DaysData.length > 0
            ? Math.round(
                last7DaysData.reduce((a, b) => a + b, 0) / last7DaysData.length
              )
            : 0;

        // Find best day - include today's count
        const allCounts = [
          ...historyEntries.map(([date, count]) => count),
          dailyCount,
        ];
        const bestDay = allCounts.length > 0 ? Math.max(...allCounts) : 0;

        // Calculate monthly total - current month only
        const currentMonth = now.getMonth();
        const currentYear = now.getFullYear();

        let thisMonth = dailyCount; // Start with today's count

        historyEntries.forEach(([date, count]) => {
          const entryDate = new Date(date);
          if (
            entryDate.getMonth() === currentMonth &&
            entryDate.getFullYear() === currentYear &&
            date !== today
          ) {
            // Don't double count today
            thisMonth += count;
          }
        });

        // Calculate streak - consecutive days with count > 0
        let streak = 0;
        const sortedDates = [...historyEntries]
          .filter(([date, count]) => count > 0)
          .sort(([a], [b]) => new Date(b) - new Date(a));

        // Check if today has activity
        if (dailyCount > 0) {
          streak = 1;

          // Check previous days
          let checkDate = new Date(now);
          for (let i = 1; i <= sortedDates.length; i++) {
            checkDate.setDate(checkDate.getDate() - 1);
            const expectedDate = checkDate.toDateString();

            const found = sortedDates.find(([date]) => date === expectedDate);
            if (found && found[1] > 0) {
              streak++;
            } else {
              break;
            }
          }
        } else {
          // If today has no activity, check if yesterday has activity
          const yesterday = new Date(now);
          yesterday.setDate(yesterday.getDate() - 1);
          const yesterdayStr = yesterday.toDateString();

          const yesterdayEntry = sortedDates.find(
            ([date]) => date === yesterdayStr
          );
          if (yesterdayEntry && yesterdayEntry[1] > 0) {
            streak = 1;

            // Check previous days
            let checkDate = new Date(yesterday);
            for (let i = 1; i <= sortedDates.length; i++) {
              checkDate.setDate(checkDate.getDate() - 1);
              const expectedDate = checkDate.toDateString();

              const found = sortedDates.find(([date]) => date === expectedDate);
              if (found && found[1] > 0) {
                streak++;
              } else {
                break;
              }
            }
          }
        }

        // Update display
        document.getElementById("summary7Day").innerText = avg7Day;
        document.getElementById("summaryBestDay").innerText = bestDay;
        document.getElementById("summaryActiveDays").innerText = activeDays;
        document.getElementById("summaryStreak").innerText = streak;
        document.getElementById("summaryMonthly").innerText = thisMonth;
      }

      function updateHistoryDetailed() {
        if (!currentCounter) return;

        const historyList = document.getElementById("historyList");
        const history = currentCounter.dailyHistory || {};

        // Clear existing content
        historyList.innerHTML = "";

        // Get all entries including today
        const today = new Date().toDateString();
        let entries = [];

        // Always include today if there's any activity
        if (dailyCount >= 0) {
          entries.push([today, dailyCount, true]); // true indicates today
        }

        // Add historical entries (exclude today to avoid duplication)
        Object.entries(history)
          .filter(([date, count]) => date !== today)
          .forEach(([date, count]) => {
            entries.push([date, count, false]);
          });

        // Apply filters
        entries = applyHistoryFilters(entries);

        // Apply sorting
        entries = applySorting(entries);

        if (entries.length === 0) {
          historyList.innerHTML = `
<div class="no-data">
<div class="no-data-icon">📿</div>
<div class="no-data-text">No history matches your filter</div>
<div class="no-data-subtext">Try adjusting your filter settings</div>
</div>
`;
          return;
        }

        entries.forEach(([date, count, isToday]) => {
          const rounds = Math.floor(count / japTarget);
          const historyItem = document.createElement("div");
          const isHighCount = count > 50;

          historyItem.className = `history-item ${
            isHighCount ? "high-count" : ""
          }`;

          historyItem.innerHTML = `
<div class="history-date">
<div class="date-main">${formatDateForDisplay(date)}</div>
<div class="date-sub">${getDayOfWeek(date)}</div>
</div>
<div class="history-stats">
<div class="history-count">
<div class="count-value">${count}</div>
<div class="count-label">Count</div>
</div>
<div class="history-count">
<div class="count-value">${rounds}</div>
<div class="count-label">Rounds</div>
</div>
</div>
<div class="history-actions">
${
  !isToday && count > 0
    ? `
<button class="action-btn edit-btn" onclick="editHistoryEntry('${date}', ${count})">✏️</button>
<button class="action-btn delete-btn" onclick="deleteHistoryEntry('${date}')">🗑️</button>
`
    : isToday
    ? '<span style="font-size: 12px; color: #ff4500;">Today</span>'
    : '<span style="font-size: 11px; color: #999;">No Activity</span>'
}
</div>
`;

          historyList.appendChild(historyItem);
        });
      }

      function applyHistoryFilters(entries) {
        const now = new Date();
        const sevenDaysAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);
        const monthStart = new Date(now.getFullYear(), now.getMonth(), 1);

        switch (currentFilter) {
          case "all":
            return entries.filter(
              ([date, count]) => count > 0 || date === now.toDateString()
            );
          case "high":
            return entries.filter(([date, count]) => count > 50);
          case "completed":
            return entries.filter(
              ([date, count]) => Math.floor(count / japTarget) > 0
            );
          case "recent":
            return entries.filter(([date, count]) => {
              const entryDate = new Date(date);
              return entryDate >= sevenDaysAgo;
            });
          case "month":
            return entries.filter(([date, count]) => {
              const entryDate = new Date(date);
              return entryDate >= monthStart;
            });
          default:
            return entries;
        }
      }

      function applySorting(entries) {
        return entries.sort(([dateA, countA], [dateB, countB]) => {
          if (currentSort === "date") {
            const comparison = new Date(dateB) - new Date(dateA);
            return isDescending ? comparison : -comparison;
          } else if (currentSort === "count") {
            const comparison = countB - countA;
            return isDescending ? comparison : -comparison;
          }
          return 0;
        });
      }

      function filterHistory(type) {
        currentFilter = type;

        // Update chip states
        document
          .querySelectorAll(".filter-chip")
          .forEach((chip) => chip.classList.remove("active"));
        event.target.classList.add("active");

        updateHistoryDetailed();
      }

      function editHistoryEntry(date, currentCount) {
        document.getElementById(
          "editHistoryDate"
        ).textContent = `Date: ${formatDateForDisplay(date)}`;
        document.getElementById("historyCountInput").value = currentCount;
        document.getElementById("editHistoryModal").style.display = "flex";

        // Store the date being edited
        window.editingHistoryDate = date;
      }

      function deleteHistoryEntry(date) {
        if (confirm(`Delete entry for ${formatDateForDisplay(date)}?`)) {
          if (currentCounter && currentCounter.dailyHistory) {
            const deletedCount = currentCounter.dailyHistory[date] || 0;
            delete currentCounter.dailyHistory[date];

            // Update lifetime count
            currentCounter.lifetimeCount = Math.max(
              0,
              currentCounter.lifetimeCount - deletedCount
            );
            lifetimeCount = currentCounter.lifetimeCount;

            saveCounterData();
            updateDisplay();
            updateHistoryDetailed();
            updateHistorySummary();
          }
        }
      }

      function toggleMenu() {
        const menu = document.getElementById("menuDropdown");
        menu.style.display = menu.style.display === "flex" ? "none" : "flex";
      }

      function closeMenu() {
        document.getElementById("menuDropdown").style.display = "none";
      }

      function toggleSwitch(el) {
        el.classList.toggle("active");
      }

      function toggleVibration(el) {
        el.classList.toggle("active");
        vibrationOn = el.classList.contains("active");

        const toggleText = el.querySelector(".toggle-text");
        if (toggleText) {
          toggleText.innerText = vibrationOn ? "ON" : "OFF";
        }
      }

      function initializeEditButton() {
        // Edit functionality removed - mantra always shows counter name
      }

      // ENHANCED THEME COLOR FUNCTIONS
      function loadThemeColor() {
        const savedColor = localStorage.getItem("themeColor");
        if (savedColor) {
          currentThemeColor = savedColor;
          applyThemeColor(currentThemeColor);
        }
      }

      function saveThemeColor(color) {
        localStorage.setItem("themeColor", color);
      }

      function toggleColorPicker() {
        const dropdown = document.getElementById("colorPickerDropdown");
        const isShowing = dropdown.classList.contains("show");

        if (isShowing) {
          // Hide with animation
          dropdown.classList.remove("show");
          setTimeout(() => {
            dropdown.style.display = "none";
          }, 300);
        } else {
          // Show with animation
          dropdown.style.display = "block";
          // Small delay to ensure display is set
          setTimeout(() => {
            dropdown.classList.add("show");
          }, 10);
        }
      }

      function selectThemeColor(color) {
        // Apply theme immediately for better responsiveness
        currentThemeColor = color;
        applyThemeColor(color);
        saveThemeColor(color);

        // Update the color circle
        document.getElementById("themeColorCircle").style.background = color;

        // Update selected color in picker
        document.querySelectorAll(".color-option").forEach((option) => {
          option.classList.remove("selected");
        });

        document
          .querySelector(`[data-color="${color}"]`)
          .classList.add("selected");

        // Show brief animation preview with new color
        showThemeChangeAnimation();

        // Close the picker
        const dropdown = document.getElementById("colorPickerDropdown");
        dropdown.classList.remove("show");
        setTimeout(() => {
          dropdown.style.display = "none";
        }, 300);
      }

      function showThemeChangeAnimation() {
        const animation = document.getElementById("openingAnimation");
        if (animation) {
          // Update content for theme change
          const title = animation.querySelector(".opening-title");
          const subtitle = animation.querySelector(".opening-subtitle");

          if (title) title.textContent = "Theme Updated";
          if (subtitle) subtitle.textContent = "New colors applied";

          // Reset all beads to visible for theme preview
          const beads = animation.querySelectorAll(".mala-bead");
          const tassel = animation.querySelector(".mala-tassel");

          beads.forEach((bead) => {
            bead.style.opacity = "1";
            bead.style.transform = "scale(1)";
          });

          if (tassel) {
            tassel.style.opacity = "1";
          }

          // Show animation briefly
          animation.style.display = "flex";
          animation.classList.remove("hide");

          setTimeout(() => {
            animation.classList.add("hide");
            setTimeout(() => {
              animation.style.display = "none";
              // Reset content
              if (title) title.textContent = "Jap Counter";
              if (subtitle)
                subtitle.textContent = "Spiritual Counting Companion";

              // Reset beads for next animation
              beads.forEach((bead) => {
                bead.style.opacity = "0";
                bead.style.transform = "scale(0)";
              });

              if (tassel) {
                tassel.style.opacity = "0";
              }
            }, 800);
          }, 2000);
        }
      }

      function applyThemeColor(color) {
        // Create CSS rule to override all orange colors
        const styleSheet = document.createElement("style");
        const colorRgba = hexToRgba(color, 0.3);
        styleSheet.innerHTML = `
/* Override all theme colors with selected color */
.logo-corner,
.logo-circle,
.menu-bar,
.create-btn,
.add-counter-btn,
.tap-btn,
.side-btn,
.btn,
.toggle.active,
.history-tab.active,
.filter-chip.active,
.stat-card {
background: ${color} !important;
}

/* Opening Animation Colors - Clean theme integration */
.mala-bead {
background: ${color} !important;
box-shadow: 0 4px 12px ${colorRgba}, 
            inset 0 2px 4px rgba(255, 255, 255, 0.5) !important;
}

.tassel-top {
background: ${color} !important;
box-shadow: 0 4px 12px ${colorRgba},
            inset 0 2px 4px rgba(255, 255, 255, 0.5) !important;
}

.tassel-middle {
background: ${color} !important;
}

.tassel-string {
background: linear-gradient(to bottom, ${color}, transparent) !important;
}

.loading-dot {
background: ${color} !important;
}

/* Fix borders for tap and side buttons */
.tap-btn {
border: 4px solid ${color} !important;
}

.side-btn {
border: 3px solid ${color} !important;
}

.logo-corner:hover,
.add-counter-btn:hover,
.tap-btn:hover,
.side-btn:hover,
.btn:hover {
background: ${adjustColorBrightness(color, -20)} !important;
}

.tap-btn:hover {
border-color: ${adjustColorBrightness(color, -20)} !important;
}

.side-btn:hover {
border-color: ${adjustColorBrightness(color, -20)} !important;
}

.tap-btn:active,
.side-btn:active,
.btn:active {
background: ${adjustColorBrightness(color, -40)} !important;
}

.tap-btn:active {
border-color: ${adjustColorBrightness(color, -40)} !important;
}

.side-btn:active {
border-color: ${adjustColorBrightness(color, -40)} !important;
}

.counter-card::before,
.welcome-box::before {
background: linear-gradient(90deg, ${color}, ${adjustColorBrightness(
          color,
          20
        )}) !important;
}

.create-btn,
.pro-btn,
.settings-modal,
.history-modal {
border-color: ${color} !important;
}

.stat-value,
.rounds-value,
.count-value,
.history-summary h3,
.summary-stat .value {
color: ${color} !important;
}

.btn {
box-shadow: 0 0 12px ${color}, 0 4px 8px rgba(0, 0, 0, 0.2) !important;
}

.btn:hover {
box-shadow: 0 0 18px ${adjustColorBrightness(
          color,
          -20
        )}, 0 6px 12px rgba(0, 0, 0, 0.25) !important;
}

.counter-name-input:focus {
border-color: ${color} !important;
box-shadow: 0 0 0 4px ${color}19 !important;
}

.scrollbar-thumb,
.counters-grid::-webkit-scrollbar-thumb {
background: ${color} !important;
}

.menu-dropdown button:hover {
background: ${color} !important;
}

.filter-chip:hover:not(.active) {
border-color: ${color} !important;
color: ${color} !important;
}

.history-item::before {
background: ${color} !important;
}

.settings-header,
.history-header {
background: ${color} !important;
}

.color-picker-dropdown {
border-color: ${color} !important;
}

`;

        // Remove old theme style if exists
        const oldStyle = document.getElementById("themeStyle");
        if (oldStyle) {
          oldStyle.remove();
        }

        styleSheet.id = "themeStyle";
        document.head.appendChild(styleSheet);
      }

      function hexToRgba(hex, alpha) {
        const r = parseInt(hex.slice(1, 3), 16);
        const g = parseInt(hex.slice(3, 5), 16);
        const b = parseInt(hex.slice(5, 7), 16);
        return `rgba(${r}, ${g}, ${b}, ${alpha})`;
      }

      function adjustColorBrightness(color, percent) {
        // Convert hex to RGB
        const hex = color.replace("#", "");
        const r = parseInt(hex.substr(0, 2), 16);
        const g = parseInt(hex.substr(2, 2), 16);
        const b = parseInt(hex.substr(4, 2), 16);

        // Adjust brightness
        const newR = Math.max(0, Math.min(255, r + (r * percent) / 100));
        const newG = Math.max(0, Math.min(255, g + (g * percent) / 100));
        const newB = Math.max(0, Math.min(255, b + (b * percent) / 100));

        // Convert back to hex
        return `#${Math.round(newR).toString(16).padStart(2, "0")}${Math.round(
          newG
        )
          .toString(16)
          .padStart(2, "0")}${Math.round(newB).toString(16).padStart(2, "0")}`;
      }

      // HOME EVENT LISTENERS
      document
        .getElementById("createCounterBtn")
        .addEventListener("click", function () {
          const nameInput = document.getElementById("counterNameInput");
          const name = nameInput.value.trim();

          if (name === "") {
            alert("Please enter a counter name");
            nameInput.focus();
            return;
          }

          if (
            counters.some((c) => c.name.toLowerCase() === name.toLowerCase())
          ) {
            alert("A counter with this name already exists");
            nameInput.focus();
            return;
          }

          const newCounter = createCounter(name);
          counters.push(newCounter);
          saveCounters();

          nameInput.value = "";
          showHomeScreen();
        });

      document
        .getElementById("counterNameInput")
        .addEventListener("keypress", function (e) {
          if (e.key === "Enter") {
            document.getElementById("createCounterBtn").click();
          }
        });

      document
        .getElementById("addCounterBtn")
        .addEventListener("click", function () {
          showWelcomeScreen();
        });

      // History edit modal event listeners
      document
        .getElementById("saveHistoryEdit")
        .addEventListener("click", function () {
          const newCount = parseInt(
            document.getElementById("historyCountInput").value
          );
          const date = window.editingHistoryDate;

          if (isNaN(newCount) || newCount < 0) {
            alert("Please enter a valid count (0 or greater)");
            return;
          }

          if (currentCounter && currentCounter.dailyHistory && date) {
            const oldCount = currentCounter.dailyHistory[date] || 0;
            const difference = newCount - oldCount;

            if (newCount === 0) {
              delete currentCounter.dailyHistory[date];
            } else {
              currentCounter.dailyHistory[date] = newCount;
            }

            // Update lifetime count
            currentCounter.lifetimeCount = Math.max(
              0,
              currentCounter.lifetimeCount + difference
            );
            lifetimeCount = currentCounter.lifetimeCount;

            saveCounterData();
            updateDisplay();
            updateHistoryDetailed();
            updateHistorySummary();
          }

          document.getElementById("editHistoryModal").style.display = "none";
        });

      document
        .getElementById("cancelHistoryEdit")
        .addEventListener("click", function () {
          document.getElementById("editHistoryModal").style.display = "none";
        });

      // Close dropdown when clicking outside
      document.addEventListener("click", function (event) {
        const menu = document.getElementById("menuDropdown");
        const menuBar = document.querySelector(".menu-bar");

        if (menuBar && !menuBar.contains(event.target)) {
          menu.style.display = "none";
        }
      });

      // Close modals when clicking overlay
      document.getElementById("overlay").addEventListener("click", function () {
        closeSettings();
        closeHistory();
      });

      // Close color picker when clicking outside
      document.addEventListener("click", function (event) {
        const colorPicker = document.getElementById("colorPickerDropdown");
        const colorCircle = document.getElementById("themeColorCircle");

        if (
          colorPicker &&
          colorCircle &&
          !colorPicker.contains(event.target) &&
          !colorCircle.contains(event.target)
        ) {
          if (colorPicker.classList.contains("show")) {
            colorPicker.classList.remove("show");
            setTimeout(() => {
              colorPicker.style.display = "none";
            }, 300);
          }
        }
      });

      // Keyboard navigation for wallpaper lightbox
      document.addEventListener("keydown", (e) => {
        if (e.key === "Escape") {
          const lightbox = document.getElementById("wallpaperLightbox");
          if (lightbox && lightbox.classList.contains("active")) {
            lightbox.classList.remove("active");
            document.body.style.overflow = "auto";
            currentDeityForLightbox = null;
          }

          const modal = document.getElementById("wallpaperModal");
          if (modal && modal.classList.contains("show")) {
            closeWallpaperModal();
          }
        }
      });

      // Close edit modals when clicking outside
      document
        .getElementById("editHistoryModal")
        .addEventListener("click", function (e) {
          if (e.target === this) {
            this.style.display = "none";
          }
        });

      // Auto-focus on counter name input when welcome screen is shown
      const observer = new MutationObserver(function (mutations) {
        mutations.forEach(function (mutation) {
          if (
            mutation.target.id === "welcomeScreen" &&
            mutation.target.style.display !== "none"
          ) {
            setTimeout(() => {
              document.getElementById("counterNameInput").focus();
            }, 100);
          }
        });
      });

      observer.observe(document.getElementById("welcomeScreen"), {
        attributes: true,
        attributeFilter: ["style"],
      });

      // Auto-save every 30 seconds
      setInterval(() => {
        if (currentCounter) {
          saveCounterData();
        }
      }, 30000);
      document.addEventListener("deviceready", async () => {
        const { AdMob, BannerAd, BannerAdSize } = admob;

        // Initialize AdMob
        await AdMob.start();

        // Create and show a banner ad
        const banner = new BannerAd({
          adUnitId: "ca-app-pub-3940256099942544/6300978111", // test AdMob ID
          position: "bottom",
        });
        await banner.show();
      });
    </script>

    <!-- Wallpaper Gallery Modal -->
    <div id="wallpaperModal" class="wallpaper-modal">
      <button class="wallpaper-close-btn" onclick="closeWallpaperModal()">
        ✕
      </button>
      <div class="wallpaper-modal-content">
        <div class="wallpaper-modal-header">
          <h2 class="wallpaper-modal-title">
            Divine Gallery - Select Wallpaper
          </h2>
        </div>
        <div id="wallpaperGrid" class="wallpaper-grid"></div>
      </div>
    </div>

    <!-- Wallpaper Lightbox -->
    <div
      id="wallpaperLightbox"
      class="wallpaper-lightbox"
      onclick="closeWallpaperLightbox(event)"
    >
      <button
        class="wallpaper-lightbox-close"
        onclick="closeWallpaperLightbox(event)"
      >
        ✕
      </button>
      <div class="wallpaper-lightbox-content">
        <div class="wallpaper-lightbox-controls">
          <button
            class="wallpaper-lightbox-btn"
            onclick="setAsWallpaper(event)"
            title="Set as Wallpaper"
          >
            Set Wallpaper
          </button>
          <button
            class="wallpaper-lightbox-btn"
            onclick="downloadWallpaper(event)"
            title="Download"
          >
            ⬇
          </button>
        </div>
        <img
          id="wallpaperLightboxImage"
          class="wallpaper-lightbox-image"
          src=""
          alt=""
        />
        <h2 id="wallpaperLightboxTitle" class="wallpaper-lightbox-title"></h2>
      </div>
    </div>
  </body>
</html>
